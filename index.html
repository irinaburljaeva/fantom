<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–®–ê–ì–ê–ô –î–û–ú–ê ‚Äî –ù–∞–π–¥–∏ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è</title>
<style>
:root{--brand:#e24a27;--text:#222;--bg:#fff;--panel:#f7f8f9}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
img{max-width:100%;display:block}
button{cursor:pointer;background:var(--brand);color:#fff;border:none;border-radius:8px;padding:10px 18px;font-size:1rem;transition:.2s}
button:hover{box-shadow:0 4px 14px rgba(226,74,39,.3);transform:translateY(-1px)}
button[aria-disabled="true"]{opacity:.6;cursor:default;box-shadow:none;transform:none}

/* —Å–æ—Å—Ç–æ—è–Ω–∏—è */
body.prestart #hud,
body.prestart #gameWrap { display: none !important; }
body.started #introWrap { display: none !important; }

/* Intro */
.intro-wrap{max-width:960px;margin:0 auto;padding:20px}
.intro{position:relative;overflow:hidden;border-radius:18px;background:#f1f2f3;box-shadow:0 10px 30px rgba(0,0,0,.08)}
.intro figure{margin:0;position:absolute;inset:0}
.intro img{width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .3s}
.intro img.ready{opacity:1}
.intro .panel{position:relative;padding:24px;background:rgba(255,255,255,.86);backdrop-filter:blur(6px)}
.intro h1{margin:0 0 8px;font-size:1.8rem}
.intro p{margin:10px 0;line-height:1.45}
blockquote.msg{margin:14px 0;padding:10px 14px;background:#fff;border-radius:14px;border:1px solid rgba(0,0,0,.08);box-shadow:0 4px 12px rgba(0,0,0,.06)}
.msg-head{display:flex;align-items:center;gap:8px;font-size:.9em;color:#555;margin-bottom:4px}
.msg-avatar{width:22px;height:22px;display:grid;place-items:center;border-radius:50%;background:#f6f7f9}
.msg-author{font-weight:600;color:#222}
.msg-dot{opacity:.6}
.msg-time{opacity:.6}
blockquote.msg p{margin:0;font-size:.97em}
footer{text-align:right;margin-top:16px}

/* HUD */
.hud{position:sticky;top:0;background:#fff;border-bottom:1px solid rgba(0,0,0,.08);display:flex;align-items:center;gap:10px;padding:8px 14px;z-index:10}
.badge{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:20px;padding:6px 10px}
.progress{flex:1;height:6px;background:#e0e0e0;border-radius:10px;overflow:hidden}
.bar{height:100%;width:0;background:var(--brand);transition:width .3s}

/* Game area */
.play-wrap{max-width:1100px;margin:20px auto;display:flex;flex-wrap:wrap;gap:20px;padding:0 14px}
.stage-wrap{flex:1 1 650px;min-width:320px}
.stage{position:relative;aspect-ratio:16/10;border-radius:16px;overflow:hidden;background:#ddd center/cover no-repeat;box-shadow:0 10px 30px rgba(0,0,0,.1)}
.layer{position:absolute;inset:0}
.pill{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:8px 12px;font-size:.95rem}
.dock{margin-top:8px;display:flex;justify-content:space-between;align-items:center}
.side{flex:0 0 340px;background:var(--panel);border-radius:16px;padding:16px;border:1px solid rgba(0,0,0,.06);box-shadow:0 8px 20px rgba(0,0,0,.1);display:none}
.side h3{margin:0 0 8px}
.side p{margin:0 0 10px}
.hint{background:#fff;border-radius:10px;border:1px dashed rgba(0,0,0,.2);padding:10px 12px;margin-bottom:10px}
.btns{display:flex;gap:8px;flex-wrap:wrap}
.toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:12px;display:none}
.loader{position:absolute;inset:0;display:grid;place-items:center;background:rgba(255,255,255,.4);z-index:4}
.ring{width:36px;height:36px;border-radius:50%;border:4px solid rgba(0,0,0,.1);border-top-color:var(--brand);animation:spin .9s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.celebrate{position:absolute;inset:0;display:none;place-items:center;pointer-events:none}
.heart{font-size:60px;animation:pop 1.2s ease forwards}
@keyframes pop{0%{opacity:0;transform:scale(.7)}50%{opacity:1;transform:scale(1.1)}100%{opacity:0;transform:scale(1.3)}}
.modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.4);z-index:20}
.card{background:#fff;border-radius:14px;padding:16px;width:min(480px,92vw)}
.actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}
@media(max-width:700px){.side{flex:1 1 100%}}
</style>
</head>
<body class="prestart">

<div class="intro-wrap" id="introWrap">
  <section id="intro" class="intro">
    <figure><img id="introImg" alt="–û—Å–µ–Ω–Ω–∏–π –ª–µ—Å"></figure>
    <div class="panel">
      <h1>–û—Å–µ–Ω–Ω–∏–π –ª–∞–≥–µ—Ä—å ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª</h1>
      <p>–í –ª–∞–≥–µ—Ä–µ –®–ê–ì–ê–ô –î–û–ú–ê –æ—Å–µ–Ω—å—é –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á—É–¥–µ—Å–∞. –û–¥–Ω–∞–∂–¥—ã –≤ —á–∞—Ç –ø—Ä–∏—à–ª–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:</p>
      <blockquote class="msg">
        <div class="msg-head">
          <span class="msg-avatar" aria-hidden="true">‚ùî</span>
          <span class="msg-author">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
          <span class="msg-dot">‚Ä¢</span>
          <time class="msg-time">—Å–µ–≥–æ–¥–Ω—è</time>
        </div>
        <p>–ü—Ä–∏–≤–µ—Ç! –Ø –∂–∏–≤—É –∑–¥–µ—Å—å —Å –ø—Ä–æ—à–ª–æ–≥–æ —Å–µ–∑–æ–Ω–∞. –Ø –ª—é–±–ª—é —á–∞–π —Å –æ–±–ª–µ–ø–∏—Ö–æ–π, –æ—Å–µ–Ω–Ω–∏–µ –ª–∏—Å—Ç—å—è –∏ —à–∞–≥–∏ –ø–æ —É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–æ—Å–µ. –ê –µ—â—ë —è –Ω–µ–º–Ω–æ–∂–∫–æ‚Ä¶ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π.</p>
      </blockquote>
      <p>–¢–∞–∫ –≤—Å–µ —É–∑–Ω–∞–ª–∏ –ø—Ä–æ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è ‚Äî –®–∞–≥—É–Ω—é. –û–Ω –Ω–µ –ø—É–≥–∞–µ—Ç, –∞ –ø–æ–º–æ–≥–∞–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è, –≥—Ä–µ—Ç—å—Å—è –∏ –Ω–µ –≥—Ä—É—Å—Ç–∏—Ç—å. –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è: –∑–∞ –Ω–µ–¥–µ–ª—é –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –®–∞–≥—É–Ω—é –Ω–∞ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö –ª–∞–≥–µ—Ä—è –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.</p>
      <footer><button id="startBtn" type="button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button></footer>
    </div>
  </section>
</div>

<header class="hud" id="hud">
  <div class="badge">–£—Ä–æ–≤–µ–Ω—å: <span id="levelLabel" class="brand">1/1</span></div>
  <div class="progress"><div id="progressBar" class="bar"></div></div>
</header>

<section class="play-wrap" id="gameWrap">
  <div class="stage-wrap">
    <div id="stage" class="stage">
      <div id="bg" class="layer"></div>
      <div id="celebrate" class="celebrate"><div class="heart">üíñ</div></div>
      <div id="loader" class="loader" hidden><div class="ring"></div></div>
    </div>
    <div class="dock">
      <div id="levelTask" class="pill">–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ</div>
      <div class="pill">–û—á–∫–∏: <span id="score">0</span></div>
    </div>
  </div>

  <aside id="sidePanel" class="side">
    <h3>–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!</h3>
    <p>–ü–æ—Ä–∞ —Ä–∞–∑–æ–≥–Ω–∞—Ç—å —Å–æ–Ω. –Ø –ª—é–±–ª—é –Ω–∞—á–∏–Ω–∞—Ç—å –¥–µ–Ω—å —Å –ª—ë–≥–∫–∏—Ö —à–∞–≥–æ–≤ ‚Äî –∞ —Ç—ã?</p>
    <div class="hint">
      <div id="hintText">üéØ <b>–ó–∞–¥–∞–Ω–∏–µ:</b> –ø—Ä–æ–π—Ç–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞—Ä—è–¥–∫—É –Ω–∞ 2 –º–∏–Ω—É—Ç—ã.</div>
    </div>
    <div class="btns">
      <button id="reportBtn" type="button">–û—Ç—á–∏—Ç–∞—Ç—å—Å—è</button>
      <button id="nextBtn" type="button" aria-disabled="true" style="background:#26a269">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å</button>
    </div>
  </aside>
</section>

<section id="reportModal" class="modal">
  <div class="card">
    <h4>–û—Ç—á—ë—Ç –ø–æ –∑–∞–¥–∞–Ω–∏—é</h4>
    <div id="reportOptions">
      <label><input type="radio" name="task" value="steps300"> –Ø –ø—Ä–æ—à—ë–ª(–ª–∞) 300 —à–∞–≥–æ–≤</label><br/>
      <label><input type="radio" name="task" value="warmup2m"> –Ø —Å–¥–µ–ª–∞–ª(–∞) –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã</label>
    </div>
    <div class="actions">
      <button id="cancelReport" type="button" style="background:#e7eaee;color:#222">–û—Ç–º–µ–Ω–∞</button>
      <button id="submitReport" type="button">–ì–æ—Ç–æ–≤–æ</button>
    </div>
  </div>
</section>

<div id="toast" class="toast"></div>

<script>
/* ===== –ê–°–°–ï–¢–´ ===== */
const ASSETS = {
  start:'start.jpg',
  lvl1:'lvl1.jpg',       lvl1found:'lvl1found.jpg',
  lvl2:'lvl2.jpg',       lvl2found:'lvl2found.jpg'
};

/* ===== –£–†–û–í–ù–ò ===== */
const GAME_CONFIG = {
  levels: [
    {
      bg: ASSETS.lvl1,
      bgPos: 'center center',
      bgFound: ASSETS.lvl1found,
      bgFoundPos: 'center 60%',
      hotspot: { x: 97.25, y: 53.8, w: 3.4, h: 11.5 },
      taskText: 'üéØ –ó–∞–¥–∞–Ω–∏–µ: –ø—Ä–æ–π—Ç–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞—Ä—è–¥–∫—É –Ω–∞ 2 –º–∏–Ω—É—Ç—ã.'
    },
    {
      bg: ASSETS.lvl2,
      bgPos: 'center center',
      bgFound: ASSETS.lvl2found,
      bgFoundPos: 'center center',
      hotspot: { x: 80, y: 70, w: 5, h: 9 },
      introTitle: '–ì–æ—Ä—è—á–∏–π –∫–∞–∫–∞–æ',
      introText: '–ì–æ—Ä—è—á–∏–π –∫–∞–∫–∞–æ –∏ –¥–µ–Ω—å —É–∂–µ —á—É—Ç—å-—á—É—Ç—å –ª—É—á—à–µ! –ê —á—Ç–æ–±—ã –æ–Ω —Å—Ç–∞–ª —Å–æ–≤—Å–µ–º –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–º, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–µ–≥–æ –Ω–µ–º–Ω–æ–≥–æ —à–∞–≥–æ–≤',
      taskText: 'üéØ –ó–∞–¥–∞–Ω–∏–µ: —Å–¥–µ–ª–∞—Ç—å 500 —à–∞–≥–æ–≤ –ø–æ–¥ –º—É–∑—ã–∫—É –∏–ª–∏ –ø–æ—à–∞–≥–∞—Ç—å –Ω–∞ –º–µ—Å—Ç–µ 1 –º–∏–Ω—É—Ç—É.'
    }
  ]
};

/* ===== DOM ===== */
const $=s=>document.querySelector(s);
const introImg=$('#introImg'), startBtn=$('#startBtn');
const stage=$('#stage'), bgLayer=$('#bg'), loader=$('#loader');
const hudLabel=$('#levelLabel'), progressBar=$('#progressBar');
const levelTask=$('#levelTask'), scoreEl=$('#score'), toast=$('#toast');
const sidePanel=$('#sidePanel'), hintText=$('#hintText');
const reportBtn=$('#reportBtn'), nextBtn=$('#nextBtn');
const reportModal=$('#reportModal'), reportOptions=$('#reportOptions');
const cancelReport=$('#cancelReport'), submitReport=$('#submitReport');

/* ===== –°–û–°–¢–û–Ø–ù–ò–ï ===== */
let currentLevel = 0;
let state = { found:false, taskDone:false, score:0 };

/* ===== –£–¢–ò–õ–ò–¢–´ ===== */
function preload(src){return new Promise((res,rej)=>{const i=new Image();i.onload=()=>res(src);i.onerror=()=>rej(src);i.src=src;});}
function setBg(url,pos){ bgLayer.style.opacity='0'; setTimeout(()=>{ bgLayer.style.backgroundImage=`url('${url}')`; bgLayer.style.backgroundPosition=pos||'center center'; bgLayer.style.backgroundSize='cover'; bgLayer.style.opacity='1';},80); }
function showToast(msg,t=1600){ toast.textContent=msg; toast.style.display='block'; clearTimeout(showToast.tid); showToast.tid=setTimeout(()=>toast.style.display='none',t); }
function clickPt(e){ const r=stage.getBoundingClientRect(); return { x:(e.clientX-r.left)/r.width*100, y:(e.clientY-r.top)/r.height*100 }; }
function inside(p,r){ return p.x>=r.x-r.w/2 && p.x<=r.x+r.w/2 && p.y>=r.y-r.h/2 && p.y<=r.y+r.h/2; }
function showLoader(){ if(!loader) return; loader.hidden=false; loader.style.display='grid'; }
function hideLoader(){ if(!loader) return; loader.hidden=true; loader.style.display='none'; }
function updateHud(){
  const total = GAME_CONFIG.levels.length;
  hudLabel.textContent = `${currentLevel+1}/${total}`;
  const done = [...Array(total).keys()].filter(i => localStorage.getItem(`level_done_${i}`)==='1').length;
  const pct = Math.round((done/total)*100);
  progressBar.style.width = pct + '%';
}

/* ===== –ò–ù–¢–†–û –§–û–ù ===== */
preload(ASSETS.start)
  .then(src => { introImg.src = src; introImg.onload = () => introImg.classList.add('ready'); })
  .catch(()=>{});

/* ===== –°–¢–ê–†–¢ –ò–ì–†–´ ===== */
startBtn.onclick = () => {
  document.body.classList.remove('prestart');
  document.body.classList.add('started');

  // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –æ—á–∫–∏ –ø–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º —É—Ä–æ–≤–Ω—è–º
  const total = GAME_CONFIG.levels.length;
  let restored = 0;
  for(let i=0;i<total;i++){ if(localStorage.getItem(`level_done_${i}`)==='1') restored += 100; }
  state.score = restored;
  scoreEl.textContent = state.score;

  startLevel(0);
};

/* ===== –ó–ê–ü–£–°–ö –£–†–û–í–ù–Ø ===== */
async function startLevel(i){
  currentLevel = i;
  state.found = false;
  state.taskDone = false;
  sidePanel.style.display = 'none';
  levelTask.hidden = false;
  nextBtn.setAttribute('aria-disabled','true');

  updateHud();

  const L = GAME_CONFIG.levels[i];

  showLoader();
  try{
    const src = await preload(L.bg);
    setBg(src, L.bgPos);
    if(L.bgFound) preload(L.bgFound);
  } finally { hideLoader(); }

  levelTask.textContent = '–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ';

  stage.onclick = (e) => {
    if(state.found) return;
    const p = clickPt(e);
    if(inside(p, L.hotspot)) onFound(L, i);
    else showToast('–ù–µ –∑–¥–µ—Å—å üòä');
  };
}

/* ===== –ù–ê–ô–î–ï–ù–û ===== */
function onFound(L, idx){
  state.found = true;
  showLoader();
  setBg(L.bgFound, L.bgFoundPos);
  setTimeout(hideLoader, 250);

  // –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å
  const titleEl = sidePanel.querySelector('h3');
  const paraEl  = sidePanel.querySelector('p');

  if(idx === 0){
    // —É—Ä–æ–≤–µ–Ω—å 1 ‚Äî —Ç–µ–∫—Å—Ç—ã –∫–∞–∫ –±—ã–ª–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
    hintText.innerHTML = L.taskText;
  }else if(idx === 1){
    // —É—Ä–æ–≤–µ–Ω—å 2 ‚Äî —Ç–≤–æ–π —Ç–µ–∫—Å—Ç –ø—Ä–æ –∫–∞–∫–∞–æ + –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
    if(titleEl) titleEl.textContent = '–ì–æ—Ä—è—á–∏–π –∫–∞–∫–∞–æ';
    if(paraEl)  paraEl.textContent  = L.introText;
    hintText.innerHTML = L.taskText;
  }

  // –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç—á—ë—Ç–∞ –ø–æ —É—Ä–æ–≤–Ω—é
  if(idx === 0){
    reportOptions.innerHTML = `
      <label><input type="radio" name="task" value="steps300"> –Ø –ø—Ä–æ—à—ë–ª(–ª–∞) 300 —à–∞–≥–æ–≤</label><br/>
      <label><input type="radio" name="task" value="warmup2m"> –Ø —Å–¥–µ–ª–∞–ª(–∞) –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã</label>
    `;
  } else if(idx === 1){
    reportOptions.innerHTML = `
      <label><input type="radio" name="task" value="steps500"> –Ø —Å–¥–µ–ª–∞–ª(–∞) 500 —à–∞–≥–æ–≤ –ø–æ–¥ –º—É–∑—ã–∫—É</label><br/>
      <label><input type="radio" name="task" value="march1m"> –Ø –ø–æ—à–∞–≥–∞–ª(–∞) –Ω–∞ –º–µ—Å—Ç–µ 1 –º–∏–Ω—É—Ç—É</label>
    `;
  }

  levelTask.hidden = true;
  sidePanel.style.display = 'block';
}

/* ===== –û–¢–ß–Å–¢ / –ó–ê–ß–Å–¢ –£–†–û–í–ù–Ø ===== */
reportBtn.onclick = () => reportModal.style.display = 'grid';
cancelReport.onclick = () => reportModal.style.display = 'none';
submitReport.onclick = () => {
  const sel = document.querySelector('input[name="task"]:checked');
  if(!sel){ showToast('–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è üôÇ'); return; }

  state.taskDone = true;
  // –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑
  if(localStorage.getItem(`level_done_${currentLevel}`)!=='1'){
    localStorage.setItem(`level_done_${currentLevel}`,'1');
    state.score += 100;
    scoreEl.textContent = state.score;
  }

  reportModal.style.display = 'none';
  nextBtn.removeAttribute('aria-disabled');
  showToast('–û—Ç–ª–∏—á–Ω–æ! –£—Ä–æ–≤–µ–Ω—å –∑–∞—Å—á–∏—Ç–∞–Ω ‚úÖ', 1800);
  updateHud();
};

/* ===== –ü–ï–†–ï–•–û–î –ù–ê –°–õ–ï–î–£–Æ–©–ò–ô ===== */
nextBtn.onclick = () => {
  if(!state.taskDone){
    showToast('–û–π, –≤—ã –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –æ—Ç –®–∞–≥—É–Ω–∏ üôÉ', 2000);
    return;
  }
  const last = GAME_CONFIG.levels.length - 1;
  if(currentLevel < last){
    startLevel(currentLevel + 1);
  }else{
    showToast('–í—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–π–¥–µ–Ω—ã! üéâ', 2200);
  }
};
                         </script>
</body>
</html>
