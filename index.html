<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–®–ê–ì–ê–ô –î–û–ú–ê ‚Äî –ù–∞–π–¥–∏ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è</title>
<style>
  :root{ --bg:#0f0f10; --ui:#ffffff; --brand:#e24a27; --panel:#1b1c1f; --glass:rgba(18,19,22,.72) }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ui);
       font:16px/1.45 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}

  /* –í–≤–æ–¥–Ω—ã–π —Å–ª–∞–π–¥ */
  .intro{
    position:fixed; inset:0; z-index:20;
    display:grid; place-items:center; overflow:hidden;
    background:#000 center/cover no-repeat;
  }
  .intro::before{ /* –∑–∞—Ç–µ–º–Ω—è—é—â–∞—è –≤—É–∞–ª—å –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞ */
    content:""; position:absolute; inset:0;
    background:linear-gradient(180deg, rgba(0,0,0,.46), rgba(0,0,0,.62));
  }
  .intro .panel{
    position:relative; width:min(920px, 92vw);
    background:rgba(18,19,22,.45);
    border:1px solid rgba(255,255,255,.10);
    border-radius:16px; padding:18px 18px 14px;
    backdrop-filter: blur(4px);
  }
  .intro h1{margin:0 0 10px;font-size:22px}
  .intro p{margin:10px 0 0}
  .intro blockquote{
    margin:12px 0; padding:12px;
    background:rgba(255,255,255,.08);
    border-left:4px solid var(--brand); border-radius:8px;
  }
  .intro footer{display:flex; justify-content:flex-end; gap:10px; margin-top:12px}
  .btn{
    cursor:pointer; border:0; border-radius:12px; background:var(--brand); color:#fff;
    font-weight:700; padding:10px 14px; box-shadow:0 6px 18px rgba(226,74,39,.35)
  }

  /* HUD */
  .hud{
    position:fixed; inset:0 0 auto 0; height:56px;
    display:flex; align-items:center; gap:10px;
    padding:10px 14px; background:linear-gradient(180deg, rgba(0,0,0,.55), transparent);
    z-index:5; pointer-events:none;
  }
  .badge{pointer-events:auto; display:inline-flex; gap:8px; align-items:center;
    background:rgba(255,255,255,.08); padding:8px 12px; border-radius:999px; backdrop-filter:saturate(130%) blur(4px)}
  .brand{color:var(--brand); font-weight:700}
  .progress{flex:1; height:8px; background:rgba(255,255,255,.15); border-radius:999px; overflow:hidden}
  .bar{height:100%; width:0; background:var(--brand); transition:width .35s ease}
  #hintBtn{pointer-events:auto}

  /* –°—Ü–µ–Ω–∞ –∏–≥—Ä—ã */
  .stage-wrap{position:relative; width:100%; max-width:1000px; margin:70px auto 18px; aspect-ratio:16/10}
  .stage{
    position:relative; width:100%; height:100%; overflow:hidden; border-radius:16px;
    background:#121316 center/cover no-repeat; box-shadow:0 12px 40px rgba(0,0,0,.35)
  }
  .layer{position:absolute; inset:0}
  #bg{transition:opacity .25s ease}
  .dock{
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    max-width:1000px; margin:0 auto; padding:10px 4px 18px
  }
  .pill{
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
    border-radius:14px; padding:10px 14px; color:#d7d9dd
  }

  /* –ú–æ–¥–∞–ª–∫–∞ –∑–∞–¥–∞–Ω–∏—è */
  .modal{position:fixed; inset:0; display:none; place-items:center; padding:20px; z-index:10; background:rgba(0,0,0,.35)}
  .card{width:min(680px,92vw); background:var(--panel); color:#e9eaec; border-radius:16px; padding:18px; border:1px solid rgba(255,255,255,.06)}
  .card h3{margin:4px 0 8px; font-size:20px}
  .hint{padding:8px 12px; border-radius:10px; border:1px dashed rgba(255,255,255,.25); color:#b9bcc2}

  .toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:var(--glass); color:#fff; padding:10px 14px; border-radius:12px; display:none}
  .loader{position:absolute; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.35); z-index:4}
  .ring{width:42px; height:42px; border-radius:50%; border:4px solid rgba(255,255,255,.25); border-top-color:var(--brand); animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Dev hitbox */
  .devbox{outline:2px dashed #ffb703; background:transparent}

  @media (max-width:540px){
    .hud{height:auto; padding:8px 10px; gap:8px; flex-wrap:wrap}
    .pill,.btn{font-size:14px}
  }
</style>
</head>
<body>

<!-- –í–≤–æ–¥–Ω—ã–π —Å–ª–∞–π–¥: –¢–ï–ö–°–¢ –ü–û–í–ï–†–• start.jpg -->
<section id="intro" class="intro" style="background-image:url('assets/start.jpg')">
  <div class="panel">
    <h1>–û—Å–µ–Ω–Ω–∏–π –ª–∞–≥–µ—Ä—å ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª</h1>
    <p>–í –ª–∞–≥–µ—Ä–µ –®–ê–ì–ê–ô –î–û–ú–ê –æ—Å–µ–Ω—å—é –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á—É–¥–µ—Å–∞. –û–¥–Ω–∞–∂–¥—ã –≤ —á–∞—Ç –ø—Ä–∏—à–ª–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:</p>
    <blockquote>
      ¬´–ü—Ä–∏–≤–µ—Ç! –Ø –∂–∏–≤—É –∑–¥–µ—Å—å —Å –ø—Ä–æ—à–ª–æ–≥–æ —Å–µ–∑–æ–Ω–∞. –Ø –ª—é–±–ª—é —á–∞–π —Å –æ–±–ª–µ–ø–∏—Ö–æ–π, –æ—Å–µ–Ω–Ω–∏–µ –ª–∏—Å—Ç—å—è –∏ —à–∞–≥–∏ –ø–æ —É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–æ—Å–µ. –ê –µ—â—ë —è –Ω–µ–º–Ω–æ–∂–∫–æ‚Ä¶ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π.¬ª
    </blockquote>
    <p>–¢–∞–∫ –≤—Å–µ —É–∑–Ω–∞–ª–∏ –ø—Ä–æ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è ‚Äî –®–∞–≥—É–Ω—é. –û–Ω –Ω–µ –ø—É–≥–∞–µ—Ç, –∞ –ø–æ–º–æ–≥–∞–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è, –≥—Ä–µ—Ç—å—Å—è –∏ –Ω–µ –≥—Ä—É—Å—Ç–∏—Ç—å. –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è: –∑–∞ –Ω–µ–¥–µ–ª—é –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –®–∞–≥—É–Ω—é –Ω–∞ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö –ª–∞–≥–µ—Ä—è –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.</p>
    <footer><button id="startBtn" class="btn" type="button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button></footer>
  </div>
</section>

<header class="hud" aria-live="polite">
  <div class="badge">–£—Ä–æ–≤–µ–Ω—å: <span id="levelLabel" class="brand">1/1</span></div>
  <div class="progress"><div id="progressBar" class="bar"></div></div>
  <button id="hintBtn" class="btn" type="button">–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
</header>

<main class="stage-wrap" aria-hidden="true">
  <div id="stage" class="stage" role="application" aria-label="–ò–≥—Ä–æ–≤–∞—è —Å—Ü–µ–Ω–∞">
    <div id="bg" class="layer"></div>
    <div id="actors" class="layer"></div>
    <div id="loader" class="loader" hidden><div class="ring" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"></div></div>
  </div>
  <div class="dock">
    <div id="levelTask" class="pill">–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ</div>
    <div class="pill">–û—á–∫–∏: <span id="score">0</span></div>
  </div>
</main>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∑–∞–¥–∞–Ω–∏—è -->
<section id="modal" class="modal" aria-hidden="true">
  <div class="card">
    <h3>–ù–∞—à–ª–∞ –®–∞–≥—É–Ω—é!</h3>
    <p id="mStory"></p>
    <p id="mQuest" class="hint"></p>
    <footer><button type="button" class="btn" id="doneBtn">–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</button></footer>
  </div>
</section>

<div id="toast" class="toast"></div>

<script>
/* ================== –ö–û–ù–§–ò–ì ================== */
const GAME_CONFIG = {
  levels: [
    {
      bg: 'assets/lvl1.jpg',          // —Ñ–æ–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ (–¥–æ –∫–ª–∏–∫–∞)
      bgFound: 'assets/lvl1found.jpg',// —Ñ–æ–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è
      story: '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ –≤ –ª–∞–≥–µ—Ä–µ! –û—Å–µ–Ω—å —à—É—Ä—à–∏—Ç, —á–∞–π–Ω–∏–∫ —à—É–º–∏—Ç, –∞ –®–∞–≥—É–Ω—è –≥–¥–µ-—Ç–æ —Ä—è–¥–æ–º.',
      quest: '–ü—Ä–æ–π–¥–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞–π –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã.',
      hint: '–ò—â–∏ —É –ø—Ä–∞–≤–æ–π —Å—Ç–µ–Ω—ã –ø—Ä–∞–≤–æ–≥–æ –¥–æ–º–∏–∫–∞.',
      /* ¬´–ì–æ—Ä—è—á–∞—è –∑–æ–Ω–∞¬ª ‚Äî –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (—Ü–µ–Ω—Ç—Ä + —à–∏—Ä–∏–Ω–∞/–≤—ã—Å–æ—Ç–∞).
         –≠—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–¥–æ–±—Ä–∞–Ω—ã –ø–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1152√ó768,
         –≥–¥–µ –®–∞–≥—É–Ω—è —Å—Ç–æ–∏—Ç —Å–ø—Ä–∞–≤–∞ —É –ø—Ä–∞–≤–æ–π —Å—Ç–µ–Ω—ã. */
      hotspot: { x: 90, y: 46, w: 8, h: 18 }
    }
  ]
};
/* ============================================ */

const $ = s => document.querySelector(s);
const stage = $('#stage'), bgLayer = $('#bg'), actors = $('#actors');
const levelLabel = $('#levelLabel'), progressBar = $('#progressBar'), levelTask = $('#levelTask');
const modal = $('#modal'), mStory = $('#mStory'), mQuest = $('#mQuest');
const loader = $('#loader'), toast = $('#toast');
const startBtn = $('#startBtn'), intro = $('#intro'), main = document.querySelector('main'), hintBtn = $('#hintBtn');

let state = { levelIndex: 0, score: 0, started:false, preloaded:new Map(), DEV:false };

function preload(src){ if(!src) return; if(state.preloaded.has(src)) return;
  const img = new Image(); img.src = src; state.preloaded.set(src,img);
}
function setBg(url){
  bgLayer.style.opacity = '0';
  setTimeout(()=>{ bgLayer.style.background = `center/cover no-repeat url('${url}')`; bgLayer.style.opacity='1'; }, 120);
}
function showToast(msg,t=1400){ toast.textContent=msg; toast.style.display='block';
  clearTimeout(showToast.tid); showToast.tid=setTimeout(()=>toast.style.display='none',t); }
function clickToPercent(ev){
  const rect = stage.getBoundingClientRect();
  return { x: (ev.clientX-rect.left)/rect.width*100, y: (ev.clientY-rect.top)/rect.height*100 };
}
function pointInRect(pt, r){
  const L=r.x-r.w/2, R=r.x+r.w/2, T=r.y-r.h/2, B=r.y+r.h/2;
  return pt.x>=L && pt.x<=R && pt.y>=T && pt.y<=B;
}

function renderDevHitbox(){
  actors.querySelectorAll('.devbox').forEach(n=>n.remove());
  if(!state.DEV) return;
  const r = GAME_CONFIG.levels[state.levelIndex].hotspot;
  if(!r) return;
  const el = document.createElement('div');
  el.className='devbox';
  Object.assign(el.style,{
    position:'absolute',
    left:`${r.x - r.w/2}%`, top:`${r.y - r.h/2}%`, width:`${r.w}%`, height:`${r.h}%`,
    pointerEvents:'none'
  });
  actors.appendChild(el);
}

function renderLevel(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  levelLabel.textContent = `${state.levelIndex+1}/${GAME_CONFIG.levels.length}`;
  progressBar.style.width = ((state.levelIndex)/GAME_CONFIG.levels.length*100) + '%';
  levelTask.textContent = '–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ';
  actors.innerHTML=''; loader.hidden=false;

  setBg(L.bg); preload(L.bg); preload(L.bgFound);

  // –∫–ª–∏–∫–∏ –ø–æ —Å—Ü–µ–Ω–µ
  stage.onclick = (ev)=>{
    const pt = clickToPercent(ev);
    if (L.hotspot && pointInRect(pt, L.hotspot)){
      onFound(); // —É—Å–ø–µ—Ö
    } else {
      stage.animate([{transform:'scale(1)'},{transform:'scale(1.01)'},{transform:'scale(1)'}], {duration:140});
      showToast('–ù–µ –∑–¥–µ—Å—å üòä –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!');
    }
  };

  renderDevHitbox();
  setTimeout(()=> loader.hidden=true, 200);
}

function onFound(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  // —ç—Ñ—Ñ–µ–∫—Ç –Ω–µ–±–æ–ª—å—à–æ–≥–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è
  stage.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}], {duration:320, easing:'ease'});
  if(L.bgFound) setBg(L.bgFound);

  mStory.textContent = L.story;
  mQuest.textContent = '–ó–∞–¥–∞–Ω–∏–µ: ' + L.quest;
  modal.style.display='grid'; modal.setAttribute('aria-hidden','false');

  state.score += 100; $('#score').textContent = state.score;
}

$('#doneBtn').addEventListener('click', ()=>{
  modal.style.display='none'; modal.setAttribute('aria-hidden','true');
  progressBar.style.width='100%';
  levelTask.textContent='–ú–æ–ª–æ–¥–µ—Ü! –¢—ã –Ω–∞—à–ª–∞ –®–∞–≥—É–Ω—é üéâ';
});

hintBtn.addEventListener('click', ()=>{
  const L = GAME_CONFIG.levels[state.levelIndex];
  showToast('–ü–æ–¥—Å–∫–∞–∑–∫–∞: ' + (L.hint || '–ü—Ä–∏—Å–º–æ—Ç—Ä–∏—Å—å –∫ —Å–≤–µ—Ç–ª—ã–º –ø—è—Ç–Ω–∞–º.'), 2200);
});

/* –°—Ç–∞—Ä—Ç */
startBtn.addEventListener('click', ()=>{
  intro.style.display='none'; main.removeAttribute('aria-hidden');
  state.started = true; renderLevel();
});
/* DEV-—Ö–∏—Ç–±–æ–∫—Å –ø–æ –∫–ª–∞–≤–∏—à–µ D */
document.addEventListener('keydown',(e)=>{ if(e.key.toLowerCase()==='d'){ state.DEV=!state.DEV; renderDevHitbox(); } });

/* –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–æ–∂–∫–∏ */
preload('assets/start.jpg');
</script>
</body>
</html>
