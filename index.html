<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–®–ê–ì–ê–ô –î–û–ú–ê ‚Äî –ù–∞–π–¥–∏ –ø—Ä–∏–∑—Ä–∞–∫–∞ –ª–∞–≥–µ—Ä—è</title>
<style>
  :root{ --bg:#0f0f10; --ui:#fff; --brand:#e24a27; --panel:#1b1c1f; --glass:rgba(18,19,22,.72) }
  html,body{height:100%} body{margin:0;background:var(--bg);color:var(--ui);
    font:16px/1.45 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial,sans-serif}
  .hud{position:fixed;inset:0 0 auto 0;height:56px;display:flex;gap:10px;align-items:center;
    padding:10px 14px;background:linear-gradient(180deg,rgba(0,0,0,.55),transparent);z-index:5;pointer-events:none}
  .badge{pointer-events:auto;display:inline-flex;gap:8px;align-items:center;background:rgba(255,255,255,.08);
    padding:8px 12px;border-radius:999px;backdrop-filter:saturate(130%) blur(4px)}
  .brand{color:var(--brand);font-weight:700}
  .progress{flex:1;height:8px;background:rgba(255,255,255,.15);border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0;background:var(--brand);transition:width .35s ease}
  .btn{pointer-events:auto;cursor:pointer;border:0;border-radius:12px;background:var(--brand);color:#fff;
    font-weight:700;padding:10px 14px;box-shadow:0 6px 18px rgba(226,74,39,.35)}
  .stage-wrap{position:relative;width:100%;max-width:1000px;margin:70px auto 18px;aspect-ratio:16/10}
  .stage{position:relative;width:100%;height:100%;overflow:hidden;border-radius:16px;background:#121316 center/cover no-repeat;box-shadow:0 12px 40px rgba(0,0,0,.35)}
  .layer{position:absolute;inset:0}
  #bg{transition:opacity .25s ease}
  .sprite{position:absolute;display:block;transform-origin:center;cursor:pointer;user-select:none}
  .sprite.ghost{animation:float 2.5s ease-in-out infinite}
  @keyframes float{50%{transform:translateY(-2px)}}
  .dock{display:flex;gap:10px;align-items:center;justify-content:space-between;max-width:1000px;margin:0 auto;padding:10px 4px 18px}
  .pill{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:10px 14px;color:#d7d9dd}
  .modal{position:fixed;inset:0;display:none;place-items:center;padding:20px;z-index:10;background:rgba(0,0,0,.35)}
  .card{width:min(680px,92vw);background:var(--panel);color:#e9eaec;border-radius:16px;padding:18px;border:1px solid rgba(255,255,255,.06)}
  .hint{padding:8px 12px;border-radius:10px;border:1px dashed rgba(255,255,255,.25);color:#b9bcc2}
  .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:var(--glass);color:#fff;padding:10px 14px;border-radius:12px;display:none}
  .loader{position:absolute;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.35);z-index:4}
  .ring{width:42px;height:42px;border-radius:50%;border:4px solid rgba(255,255,255,.25);border-top-color:var(--brand);animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  /* –í–≤–æ–¥–Ω—ã–π —Å–ª–∞–π–¥ */
  .intro{position:fixed;inset:0;z-index:20;background:#000 center/cover no-repeat;display:grid;place-items:center}
  .intro .overlay{background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.55));position:absolute;inset:0}
  .intro .panel{position:relative;max-width:860px;margin:0 16px;background:rgba(18,19,22,.6);border:1px solid rgba(255,255,255,.1);
    border-radius:16px;padding:18px;backdrop-filter:blur(4px)}
  .intro h1{margin:0 0 8px;font-size:22px}
  .intro blockquote{margin:10px 0;padding:10px 12px;background:rgba(255,255,255,.06);border-left:4px solid var(--brand);border-radius:8px}
  .intro footer{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  @media (max-width:540px){.hud{gap:8px;flex-wrap:wrap;padding:8px 10px}.pill,.btn{font-size:14px}}
</style>
</head>
<body>

<!-- –í–≤–æ–¥–Ω—ã–π —Å–ª–∞–π–¥ -->
<section id="intro" class="intro" style="background-image:url('assets/start.jpg')">
  <div class="overlay" aria-hidden="true"></div>
  <div class="panel" role="dialog" aria-modal="true">
    <h1>–û—Å–µ–Ω–Ω–∏–π –ª–∞–≥–µ—Ä—å ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª</h1>
    <p>–í –ª–∞–≥–µ—Ä–µ –®–ê–ì–ê–ô –î–û–ú–ê –æ—Å–µ–Ω—å—é –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á—É–¥–µ—Å–∞. –û–¥–Ω–∞–∂–¥—ã –≤ —á–∞—Ç –ø—Ä–∏—à–ª–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:</p>
    <blockquote>
      ¬´–ü—Ä–∏–≤–µ—Ç! –Ø –∂–∏–≤—É –∑–¥–µ—Å—å —Å –ø—Ä–æ—à–ª–æ–≥–æ —Å–µ–∑–æ–Ω–∞. –Ø –ª—é–±–ª—é —á–∞–π —Å –æ–±–ª–µ–ø–∏—Ö–æ–π, –æ—Å–µ–Ω–Ω–∏–µ –ª–∏—Å—Ç—å—è –∏ —à–∞–≥–∏ –ø–æ —É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–æ—Å–µ. –ê –µ—â—ë —è –Ω–µ–º–Ω–æ–∂–∫–æ‚Ä¶ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π.¬ª
    </blockquote>
    <p>–¢–∞–∫ –≤—Å–µ —É–∑–Ω–∞–ª–∏ –ø—Ä–æ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è ‚Äî –®–∞–≥—É–Ω—é. –û–Ω –Ω–µ –ø—É–≥–∞–µ—Ç, –∞ –ø–æ–º–æ–≥–∞–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è, –≥—Ä–µ—Ç—å—Å—è –∏ –Ω–µ –≥—Ä—É—Å—Ç–∏—Ç—å. –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è: –∑–∞ –Ω–µ–¥–µ–ª—é –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –®–∞–≥—É–Ω—é –Ω–∞ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö –ª–∞–≥–µ—Ä—è –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.</p>
    <footer>
      <button id="startBtn" class="btn" type="button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </footer>
  </div>
</section>

<header class="hud" aria-live="polite">
  <div class="badge">–£—Ä–æ–≤–µ–Ω—å: <span id="levelLabel" class="brand">1/4</span></div>
  <div class="progress"><div id="progressBar" class="bar"></div></div>
  <button id="hintBtn" class="btn" type="button">–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
</header>

<main class="stage-wrap" aria-hidden="true">
  <div id="stage" class="stage" role="application" aria-label="–ò–≥—Ä–æ–≤–∞—è —Å—Ü–µ–Ω–∞">
    <div id="bg" class="layer"></div>
    <div id="actors" class="layer"></div>
    <div id="loader" class="loader" hidden><div class="ring" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"></div></div>
  </div>
  <div class="dock">
    <div id="levelTask" class="pill">–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ</div>
    <div class="pill">–û—á–∫–∏: <span id="score">0</span></div>
  </div>
</main>

<section id="modal" class="modal" aria-hidden="true">
  <div class="card">
    <h3 id="mTitle">–ù–∞—à–ª–∞ –®–∞–≥—É–Ω—é!</h3>
    <p id="mStory"></p>
    <p id="mQuest" class="hint"></p>
    <footer><button type="button" class="btn" id="doneBtn">–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</button></footer>
  </div>
</section>

<div id="toast" class="toast"></div>

<script>
/* ================ –ö–û–ù–§–ò–ì ================ */
const GAME_CONFIG = {
  assets: {
    ghost: 'assets/ghost_main.png',
    decoys: [
      'assets/decoy_blanket.png',
      'assets/decoy_towel.png',
      'assets/decoy_mug_steam.png',
      'assets/decoy_light_blob.png',
      'assets/decoy_socks.png',
      'assets/decoy_steam_cloud.png'
    ]
  },
  levels: [
    {
      bg: 'assets/lvl1.jpg',
      bgFound: 'assets/lvl1found.jpg',
      story: '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ –≤ –ª–∞–≥–µ—Ä–µ! –û—Å–µ–Ω—å —à—É—Ä—à–∏—Ç, —á–∞–π–Ω–∏–∫ —à—É–º–∏—Ç, –∞ –®–∞–≥—É–Ω—è –≥–¥–µ-—Ç–æ —Ä—è–¥–æ–º.',
      quest: '–ü—Ä–æ–π–¥–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞–π –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã.',
      hint: '–®–∞–≥—É–Ω—è –ª—é–±–∏—Ç –±—ã–≤–∞—Ç—å —Ä—è–¥–æ–º —Å —Ç—ë–ø–ª—ã–º–∏ –≤–µ—â–∞–º–∏.',
      ghost: { x: 62, y: 62, w: 10 },
      decoys: [
        { x: 18, y: 64, w: 9, img: 0 },
        { x: 72, y: 28, w: 8, img: 2 },
        { x: 40, y: 70, w: 10, img: 4 }
      ]
    },
    /* –î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —É—Ä–æ–≤–Ω–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ‚Ä¶
    {
      bg: 'assets/lvl2.jpg', bgFound: 'assets/lvl2found.jpg',
      story:'‚Ä¶', quest:'‚Ä¶', hint:'‚Ä¶',
      ghost:{x:35,y:38,w:9},
      decoys:[{x:12,y:52,w:8,img:1},{x:60,y:18,w:7,img:3}]
    }
    */
  ]
};
/* ======================================== */

const $ = s => document.querySelector(s);
const stage = $('#stage'), bgLayer = $('#bg'), actors = $('#actors');
const modal = $('#modal'), mStory = $('#mStory'), mQuest = $('#mQuest');
const levelTask = $('#levelTask'), levelLabel = $('#levelLabel'), progressBar = $('#progressBar');
const toast = $('#toast'), loader = $('#loader');
const hintBtn = $('#hintBtn'), startBtn = $('#startBtn'), intro = $('#intro');
const main = document.querySelector('main');

let state = { levelIndex: 0, score: 0, preloaded: new Map(), started:false };

function preload(src){ if(!src) return;
  if(state.preloaded.has(src)) return state.preloaded.get(src);
  const img = new Image(); img.src = src; state.preloaded.set(src,img); return img;
}
function setBg(url){
  bgLayer.style.opacity = '0';
  setTimeout(()=>{ bgLayer.style.background = `center/cover no-repeat url('${url}')`; bgLayer.style.opacity='1'; }, 120);
}
function percentPos(el,{x,y,w}){ el.style.left=x+'%'; el.style.top=y+'%'; el.style.width=w+'%'; el.style.transform='translate(-50%,-50%)'; el.style.position='absolute'; }

function renderLevel(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  levelLabel.textContent = `${state.levelIndex+1}/${GAME_CONFIG.levels.length}`;
  progressBar.style.width = ((state.levelIndex)/GAME_CONFIG.levels.length*100) + '%';
  levelTask.textContent = '–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ';
  actors.innerHTML=''; loader.hidden=false;

  setBg(L.bg); preload(L.bg); if(L.bgFound) preload(L.bgFound);
  preload(GAME_CONFIG.assets.ghost); L.decoys.forEach(d=>preload(GAME_CONFIG.assets.decoys[d.img]));

  // –æ–±–º–∞–Ω–∫–∏
  L.decoys.forEach(d=>{
    const el=document.createElement('img');
    el.className='sprite'; el.alt='–æ–±—ä–µ–∫—Ç'; el.src=GAME_CONFIG.assets.decoys[d.img];
    percentPos(el,d); el.addEventListener('click',()=>showToast('–≠—Ç–æ –Ω–µ –®–∞–≥—É–Ω—è üòä')); actors.appendChild(el);
  });
  // –®–∞–≥—É–Ω—è
  const ghost=document.createElement('img');
  ghost.className='sprite ghost'; ghost.alt='–®–∞–≥—É–Ω—è'; ghost.src=GAME_CONFIG.assets.ghost;
  percentPos(ghost,L.ghost); ghost.addEventListener('click',onFoundGhost); actors.appendChild(ghost);

  setTimeout(()=> loader.hidden=true, 200);
}
function onFoundGhost(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  if(L.bgFound) setBg(L.bgFound);
  mStory.textContent = L.story; mQuest.textContent = '–ó–∞–¥–∞–Ω–∏–µ: ' + L.quest;
  modal.style.display='grid'; modal.setAttribute('aria-hidden','false');
  state.score += 100; $('#score').textContent = state.score.toString();
}
$('#doneBtn').addEventListener('click', ()=>{
  modal.style.display='none'; modal.setAttribute('aria-hidden','true');
  const last = state.levelIndex >= GAME_CONFIG.levels.length-1;
  if(last){ progressBar.style.width='100%'; levelTask.textContent='–ú–æ–ª–æ–¥–µ—Ü! –¢—ã –Ω–∞—à–ª–∞ –®–∞–≥—É–Ω—é –≤–æ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö.'; showToast('üèÜ –ò–≥—Ä–∞ –ø—Ä–æ–π–¥–µ–Ω–∞!'); }
  else { state.levelIndex++; renderLevel(); }
});
hintBtn.addEventListener('click', ()=>{
  const L = GAME_CONFIG.levels[state.levelIndex]; showToast('–ü–æ–¥—Å–∫–∞–∑–∫–∞: ' + (L.hint||'–ü—Ä–∏—Å–º–æ—Ç—Ä–∏—Å—å –∫ —Å–≤–µ—Ç–ª—ã–º –ø—è—Ç–Ω–∞–º.'), 2000);
});
function showToast(msg,t=1400){ toast.textContent=msg; toast.style.display='block'; clearTimeout(showToast.tid); showToast.tid=setTimeout(()=>toast.style.display='none',t); }

/* –°—Ç–∞—Ä—Ç —Å –≤–≤–æ–¥–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞ */
startBtn.addEventListener('click', ()=>{
  intro.style.display='none'; main.removeAttribute('aria-hidden');
  state.started = true; renderLevel();
});

/* –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ intro-—Ñ–æ–Ω–∞ */
preload('assets/start.jpg');
</script>
</body>
</html>
