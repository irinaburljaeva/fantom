<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–®–ê–ì–ê–ô –î–û–ú–ê ‚Äî –ù–∞–π–¥–∏ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è</title>
<style>
:root{--brand:#e24a27;--text:#222;--bg:#fff;--panel:#f7f8f9}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
img{max-width:100%;display:block}
button{cursor:pointer;background:var(--brand);color:#fff;border:none;border-radius:8px;padding:10px 18px;font-size:1rem;transition:.2s}
button:hover{box-shadow:0 4px 14px rgba(226,74,39,.3);transform:translateY(-1px)}
button[aria-disabled="true"]{opacity:.6;cursor:default;box-shadow:none;transform:none}
body.prestart #hud,body.prestart #gameWrap{display:none!important}
body.started #introWrap{display:none!important}
.intro-wrap{max-width:960px;margin:0 auto;padding:20px}
.intro{position:relative;overflow:hidden;border-radius:18px;background:#f1f2f3;box-shadow:0 10px 30px rgba(0,0,0,.08)}
.intro figure{margin:0;position:absolute;inset:0}
.intro img{width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .3s}
.intro img.ready{opacity:1}
.intro .panel{position:relative;padding:24px;background:rgba(255,255,255,.86);backdrop-filter:blur(6px)}
blockquote.msg{margin:14px 0;padding:10px 14px;background:#fff;border-radius:14px;border:1px solid rgba(0,0,0,.08);box-shadow:0 4px 12px rgba(0,0,0,.06)}
.msg-head{display:flex;align-items:center;gap:8px;font-size:.9em;color:#555;margin-bottom:4px}
.msg-avatar{width:22px;height:22px;display:grid;place-items:center;border-radius:50%;background:#f6f7f9}
.msg-author{font-weight:600;color:#222}
.hud{position:sticky;top:0;background:#fff;border-bottom:1px solid rgba(0,0,0,.08);display:flex;align-items:center;gap:10px;padding:8px 14px;z-index:10}
.badge{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:20px;padding:6px 10px}
.progress{flex:1;height:6px;background:#e0e0e0;border-radius:10px;overflow:hidden}
.bar{height:100%;width:0;background:var(--brand);transition:width .3s}
.play-wrap{max-width:1100px;margin:20px auto;display:flex;flex-wrap:wrap;gap:20px;padding:0 14px}
.stage-wrap{flex:1 1 650px;min-width:320px}
.stage{position:relative;aspect-ratio:16/10;border-radius:16px;overflow:hidden;background:#ddd center/cover no-repeat;box-shadow:0 10px 30px rgba(0,0,0,.1)}
.layer{position:absolute;inset:0}
.pill{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:8px 12px;font-size:.95rem}
.side{flex:0 0 340px;background:var(--panel);border-radius:16px;padding:16px;border:1px solid rgba(0,0,0,.06);box-shadow:0 8px 20px rgba(0,0,0,.1);display:none}
.hint{background:#fff;border-radius:10px;border:1px dashed rgba(0,0,0,.2);padding:10px 12px;margin-bottom:10px}
.toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:12px;display:none}
.loader{position:absolute;inset:0;display:grid;place-items:center;background:rgba(255,255,255,.4);z-index:4;transition:opacity .2s}
.ring{width:36px;height:36px;border-radius:50%;border:4px solid rgba(0,0,0,.1);border-top-color:var(--brand);animation:spin .9s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.4);z-index:20}
.card{background:#fff;border-radius:14px;padding:16px;width:min(520px,92vw)}
.actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}
@media(max-width:700px){.side{flex:1 1 100%}}
</style>
</head>
<body class="prestart">
<div class="intro-wrap" id="introWrap">
  <section class="intro">
    <figure><img id="introImg" alt="–û—Å–µ–Ω–Ω–∏–π –ª–µ—Å"></figure>
    <div class="panel">
      <h1>–û—Å–µ–Ω–Ω–∏–π –ª–∞–≥–µ—Ä—å ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª</h1>
      <p>–û–¥–Ω–∞–∂–¥—ã –≤ —á–∞—Ç –ø—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:</p>
      <blockquote class="msg">
        <div class="msg-head"><span class="msg-avatar">‚ùî</span><span class="msg-author">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span></div>
        <p>–ü—Ä–∏–≤–µ—Ç! –Ø –∂–∏–≤—É –∑–¥–µ—Å—å —Å –ø—Ä–æ—à–ª–æ–≥–æ —Å–µ–∑–æ–Ω–∞. –õ—é–±–ª—é —á–∞–π —Å –æ–±–ª–µ–ø–∏—Ö–æ–π, –æ—Å–µ–Ω–Ω–∏–µ –ª–∏—Å—Ç—å—è –∏ —à–∞–≥–∏ –ø–æ —Ä–æ—Å–µ. –ò —è –Ω–µ–º–Ω–æ–∂–∫–æ‚Ä¶ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π.</p>
      </blockquote>
      <p>–¢–∞–∫ —É–∑–Ω–∞–ª–∏ –ø—Ä–æ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è ‚Äî –®–∞–≥—É–Ω—é. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –∏ –≥—Ä–µ—Ç—å—Å—è. –ù–∞–π–¥–∏ –µ–≥–æ –Ω–∞ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö –ª–∞–≥–µ—Ä—è –∏ –≤—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞–Ω–∏—è!</p>
      <footer><button id="startBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button></footer>
    </div>
  </section>
</div>

<header class="hud" id="hud">
  <div class="badge">–£—Ä–æ–≤–µ–Ω—å: <span id="levelLabel">1/3</span></div>
  <div class="progress"><div id="progressBar" class="bar"></div></div>
</header>

<section class="play-wrap" id="gameWrap">
  <div class="stage-wrap">
    <div id="stage" class="stage">
      <div id="bg" class="layer"></div>
      <div id="loader" class="loader" hidden><div class="ring"></div></div>
    </div>
    <div class="pill" id="levelTask">–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ</div>
    <div class="pill">–û—á–∫–∏: <span id="score">0</span></div>
  </div>

  <aside class="side" id="sidePanel">
    <h3>–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!</h3>
    <p>–ü–æ—Ä–∞ —Ä–∞–∑–æ–≥–Ω–∞—Ç—å —Å–æ–Ω. –Ø –ª—é–±–ª—é –Ω–∞—á–∏–Ω–∞—Ç—å –¥–µ–Ω—å —Å –ª—ë–≥–∫–∏—Ö —à–∞–≥–æ–≤ ‚Äî –∞ —Ç—ã?</p>
    <div class="hint"><div id="hintText">üéØ –ø—Ä–æ–π—Ç–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ –∑–∞—Ä—è–¥–∫–∞ 2 –º–∏–Ω—É—Ç—ã.</div></div>
    <button id="reportBtn">–û—Ç—á–∏—Ç–∞—Ç—å—Å—è</button>
    <button id="nextBtn" aria-disabled="true" style="background:#26a269">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å</button>
  </aside>
</section>

<section class="modal" id="reportModal">
  <div class="card">
    <h4>–û—Ç—á—ë—Ç –ø–æ –∑–∞–¥–∞–Ω–∏—é</h4>
    <div id="reportOptions"></div>
    <div class="actions">
      <button id="cancelReport" style="background:#e7eaee;color:#222">–û—Ç–º–µ–Ω–∞</button>
      <button id="submitReport">–ì–æ—Ç–æ–≤–æ</button>
    </div>
  </div>
</section>

<div class="toast" id="toast"></div>

<script>
const ASSETS={
  start:'start.jpg',
  lvl1:'lvl1.jpg',lvl1found:'lvl1found.jpg',
  lvl2:'lvl2.jpg',lvl2found:'lvl2found.jpg',
  lvl3:'lvl3.jpg',lvl3found:'lvl3found.jpg'
};

const GAME_CONFIG={
levels:[
{
  bg:ASSETS.lvl1,bgFound:ASSETS.lvl1found,
  hotspot:{x:97.25,y:53.8,w:3.4,h:11.5},
  introTitle:'–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!',
  introText:'–ü–æ—Ä–∞ —Ä–∞–∑–æ–≥–Ω–∞—Ç—å —Å–æ–Ω. –Ø –ª—é–±–ª—é –Ω–∞—á–∏–Ω–∞—Ç—å –¥–µ–Ω—å —Å –ª—ë–≥–∫–∏—Ö —à–∞–≥–æ–≤ ‚Äî –∞ —Ç—ã?',
  taskText:'üéØ –ó–∞–¥–∞–Ω–∏–µ: –ø—Ä–æ–π—Ç–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã.',
  options:[
    ['steps300','–Ø –ø—Ä–æ—à—ë–ª(–ª–∞) 300 —à–∞–≥–æ–≤'],
    ['warmup2m','–Ø —Å–¥–µ–ª–∞–ª(–∞) –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã']
  ]
},
{
  bg:ASSETS.lvl2,bgFound:ASSETS.lvl2found,
  poly:[
    [20.65,80.12],
    [22.50,82.84],
    [20.80,87.27],
    [18.64,82.59]
  ],
  introTitle:'–ú–∏–Ω—É—Ç–∫–∞ –æ—Ç–¥—ã—Ö–∞',
  introText:'–§—É—Ö‚Ä¶ –¥–∞–∂–µ –ø—Ä–∏–∑—Ä–∞–∫–∞–º –Ω—É–∂–µ–Ω –æ—Ç–¥—ã—Ö! –ò–Ω–æ–≥–¥–∞ —Å–∞–º–æ–µ –ø–æ–ª–µ–∑–Ω–æ–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–ª–µ–∂–∞—Ç—å –∏ –ø–æ—Å–ª—É—à–∞—Ç—å, –∫–∞–∫ —à—É—Ä—à–∞—Ç –ª–∏—Å—Ç—å—è. –ê –ø–æ—Ç–æ–º, –∫–æ–Ω–µ—á–Ω–æ, –Ω–µ–º–Ω–æ–≥–æ –ø–æ—à–∞–≥–∞—Ç—å ‚Äî —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–Ω—É—Ç—å',
  taskText:'üéØ –ó–∞–¥–∞–Ω–∏–µ –¥–Ω—è: —Å–ø–æ–∫–æ–π–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ 10‚Äì15 –º–∏–Ω—É—Ç –∏–ª–∏ —Ä–∞–∑–º–∏–Ω–∫–∞ –¥–ª—è —Å–ø–∏–Ω—ã –∏ —à–µ–∏.',
  options:[
    ['walk15','–°–ø–æ–∫–æ–π–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ 10‚Äì15 –º–∏–Ω—É—Ç'],
    ['stretch','–†–∞–∑–º–∏–Ω–∫–∞ –¥–ª—è —Å–ø–∏–Ω—ã –∏ —à–µ–∏']
  ]
},
{
  bg:ASSETS.lvl3,bgFound:ASSETS.lvl3found,
  hotspot:{x:80,y:70,w:5,h:9},
  introTitle:'–ì–æ—Ä—è—á–∏–π –∫–∞–∫–∞–æ',
  introText:'–ì–æ—Ä—è—á–∏–π –∫–∞–∫–∞–æ –∏ –¥–µ–Ω—å —É–∂–µ —á—É—Ç—å-—á—É—Ç—å –ª—É—á—à–µ! –ê —á—Ç–æ–±—ã –æ–Ω —Å—Ç–∞–ª —Å–æ–≤—Å–µ–º –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–º, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–µ–≥–æ –Ω–µ–º–Ω–æ–≥–æ —à–∞–≥–æ–≤',
  taskText:'üéØ –ó–∞–¥–∞–Ω–∏–µ: —Å–¥–µ–ª–∞—Ç—å 500 —à–∞–≥–æ–≤ –ø–æ–¥ –º—É–∑—ã–∫—É –∏–ª–∏ –ø–æ—à–∞–≥–∞—Ç—å –Ω–∞ –º–µ—Å—Ç–µ 1 –º–∏–Ω—É—Ç—É.',
  options:[
    ['steps500','–Ø —Å–¥–µ–ª–∞–ª(–∞) 500 —à–∞–≥–æ–≤ –ø–æ–¥ –º—É–∑—ã–∫—É'],
    ['march1m','–Ø –ø–æ—à–∞–≥–∞–ª(–∞) –Ω–∞ –º–µ—Å—Ç–µ 1 –º–∏–Ω—É—Ç—É']
  ]
}
]};

const $=s=>document.querySelector(s);
const introImg=$('#introImg'),startBtn=$('#startBtn'),stage=$('#stage'),bgLayer=$('#bg');
const loader=$('#loader'),sidePanel=$('#sidePanel'),levelTask=$('#levelTask');
const levelLabel=$('#levelLabel'),progressBar=$('#progressBar');
const reportBtn=$('#reportBtn'),nextBtn=$('#nextBtn'),toast=$('#toast');
const hintText=$('#hintText'),reportOptions=$('#reportOptions'),scoreEl=$('#score');
const reportModal=$('#reportModal'),cancelReport=$('#cancelReport'),submitReport=$('#submitReport');
let currentLevel=0,state={found:false,taskDone:false,score:0};

function preload(src){
  return new Promise((res)=>{
    const img=new Image();img.decoding='async';
    img.onload=()=>res(src);img.onerror=()=>res(src);
    img.src=src;
    if(img.complete)res(src);
    setTimeout(()=>res(src),1200);
  });
}

let loaderTimer=null;
function showLoaderSmart(){
  clearTimeout(loaderTimer);
  loaderTimer=setTimeout(()=>{loader.hidden=false;},140);
}
function hideLoader(){
  clearTimeout(loaderTimer);
  loader.hidden=true;
}

function setBg(url){bgLayer.style.opacity='0';setTimeout(()=>{bgLayer.style.backgroundImage=`url('${url}')`;bgLayer.style.backgroundSize='cover';bgLayer.style.opacity='1';},80);}
function showToast(m,t=1600){toast.textContent=m;toast.style.display='block';clearTimeout(showToast.tid);showToast.tid=setTimeout(()=>toast.style.display='none',t);}
function clickPt(e){const r=stage.getBoundingClientRect();return{x:(e.clientX-r.left)/r.width*100,y:(e.clientY-r.top)/r.height*100};}
function inside(p,r){return p.x>=r.x-r.w/2&&p.x<=r.x+r.w/2&&p.y>=r.y-r.h/2&&p.y<=r.y+r.h/2;}
function pointInPoly(pt,poly){let c=false;for(let i=0,j=poly.length-1;i<poly.length;j=i++){const[xi,yi]=poly[i],[xj,yj]=poly[j];const inter=((yi>pt.y)!==(yj>pt.y))&&(pt.x<(xj-xi)*(pt.y-yi)/((yj-yi)||1e-6)+xi);if(inter)c=!c;}return c;}
function updateHud(){const t=GAME_CONFIG.levels.length;levelLabel.textContent=`${currentLevel+1}/${t}`;const d=[...Array(t).keys()].filter(i=>localStorage.getItem(`lvl_done_${i}`)==='1').length;progressBar.style.width=(d/t*100)+'%';}

preload(ASSETS.start).then(s=>{introImg.src=s;introImg.onload=()=>introImg.classList.add('ready');});
startBtn.onclick=()=>{document.body.classList.remove('prestart');document.body.classList.add('started');let t=GAME_CONFIG.levels.length;state.score=0;for(let i=0;i<t;i++)if(localStorage.getItem(`lvl_done_${i}`)==='1')state.score+=100;scoreEl.textContent=state.score;startLevel(0);};

async function startLevel(i){
  currentLevel=i;state.found=false;state.taskDone=false;
  sidePanel.style.display='none';levelTask.hidden=false;nextBtn.setAttribute('aria-disabled','true');updateHud();
  const L=GAME_CONFIG.levels[i];
  showLoaderSmart();
  try{const s=await preload(L.bg);setBg(s);if(L.bgFound)preload(L.bgFound);}finally{hideLoader();}
  levelTask.textContent='–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ';
  stage.onclick=e=>{
    if(state.found)return;
    const pt=clickPt(e);
    if(e.shiftKey)console.log(`x:${pt.x.toFixed(2)} y:${pt.y.toFixed(2)}`);
    let hit=false;
    if(L.poly)hit=pointInPoly(pt,L.poly);else if(L.hotspot)hit=inside(pt,L.hotspot);
    hit?onFound(L,i):showToast('–ù–µ –∑–¥–µ—Å—å üòä');
  };
}

function onFound(L,i){
  state.found=true;showLoaderSmart();setBg(L.bgFound);setTimeout(hideLoader,250);
  sidePanel.querySelector('h3').textContent=L.introTitle;
  sidePanel.querySelector('p').textContent=L.introText;
  hintText.innerHTML=L.taskText;
  reportOptions.innerHTML=L.options.map(o=>`<label><input type="radio" name="task" value="${o[0]}"> ${o[1]}</label><br/>`).join('');
  levelTask.hidden=true;sidePanel.style.display='block';
}

reportBtn.onclick=()=>reportModal.style.display='grid';
cancelReport.onclick=()=>reportModal.style.display='none';
submitReport.onclick=()=>{
  const sel=document.querySelector('input[name="task"]:checked');
  if(!sel){showToast('–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è üôÇ');return;}
  state.taskDone=true;
  if(localStorage.getItem(`lvl_done_${currentLevel}`)!=='1'){localStorage.setItem(`lvl_done_${currentLevel}`,'1');state.score+=100;scoreEl.textContent=state.score;}
  reportModal.style.display='none';nextBtn.removeAttribute('aria-disabled');showToast('–û—Ç–ª–∏—á–Ω–æ! –£—Ä–æ–≤–µ–Ω—å –∑–∞—Å—á–∏—Ç–∞–Ω ‚úÖ',1800);updateHud();
};

nextBtn.onclick=()=>{if(!state.taskDone){showToast('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞–Ω–∏–µ üôÉ');return;}if(currentLevel<GAME_CONFIG.levels.length-1)startLevel(currentLevel+1);else showToast('–í—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–π–¥–µ–Ω—ã! üéâ',2000);};
</script>
</body>
</html>
