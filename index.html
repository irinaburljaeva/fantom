<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–®–ê–ì–ê–ô –î–û–ú–ê ‚Äî –ù–∞–π–¥–∏ –ø—Ä–∏–∑—Ä–∞–∫–∞ –ª–∞–≥–µ—Ä—è</title>
<style>
  :root{
    --bg:#0f0f10;           /* —Ü–≤–µ—Ç –ø–æ–¥–ª–æ–∂–∫–∏ –≤–æ–∫—Ä—É–≥ —Å—Ü–µ–Ω—ã */
    --ui:#ffffff;           /* —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ UI */
    --brand:#e24a27;        /* –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç */
    --panel:#1b1c1f;        /* –ø–∞–Ω–µ–ª–∏/–º–æ–¥–∞–ª–∫–∏ */
    --glass:rgba(18,19,22,.72);
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ui);
    font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
  }

  /* –®–∞–ø–∫–∞ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
  .hud{
    position:fixed; inset:0 0 auto 0; height:56px; display:flex; align-items:center; gap:10px;
    padding:10px 14px; background:linear-gradient(180deg, rgba(0,0,0,.55), transparent);
    z-index:5; pointer-events:none;
  }
  .badge{pointer-events:auto; display:inline-flex; gap:8px; align-items:center;
    background:rgba(255,255,255,.08); padding:8px 12px; border-radius:999px; backdrop-filter:saturate(130%) blur(4px)}
  .brand{color:var(--brand); font-weight:700}
  .progress{flex:1; height:8px; background:rgba(255,255,255,.15); border-radius:999px; overflow:hidden}
  .bar{height:100%; width:0; background:var(--brand); transition:width .35s ease}

  .btn{
    pointer-events:auto; user-select:none; cursor:pointer; border:0; border-radius:12px;
    background:var(--brand); color:#fff; font-weight:700; padding:10px 14px;
    box-shadow:0 6px 18px rgba(226,74,39,.35); transition:.2s transform ease;
  }
  .btn:active{transform:translateY(1px)}

  /* –°—Ü–µ–Ω–∞ –∏–≥—Ä—ã */
  .stage-wrap{position:relative; width:100%; max-width:1000px; margin:70px auto 18px; aspect-ratio: 16 / 10;}
  .stage{
    position:relative; width:100%; height:100%; overflow:hidden; border-radius:16px;
    background:#121316 url("") center/cover no-repeat; box-shadow:0 12px 40px rgba(0,0,0,.35);
  }
  .layer{position:absolute; inset:0}
  .sprite{
    position:absolute; display:block; width:auto; height:auto; transform-origin:center center;
    will-change:transform, opacity; cursor:pointer; user-select:none;
    transition:filter .15s ease, transform .08s ease;
  }
  .sprite:hover{filter:brightness(1.04)}
  .sprite.ghost{animation:float 2.5s ease-in-out infinite}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}

  /* –ü–∞–Ω–µ–ª—å —É—Ä–æ–≤–Ω—è / –Ω–∏–∑ —ç–∫—Ä–∞–Ω–∞ */
  .dock{
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    max-width:1000px; margin:0 auto; padding:10px 4px 18px;
  }
  .pill{
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
    border-radius:14px; padding:10px 14px; color:#d7d9dd;
  }

  /* –ú–æ–¥–∞–ª–∫–∞ –∑–∞–¥–∞–Ω–∏—è */
  .modal{
    position:fixed; inset:0; display:none; place-items:center; padding:20px; z-index:10;
    background:rgba(0,0,0,.35);
  }
  .card{
    width:min(680px, 92vw); background:var(--panel); color:#e9eaec; border-radius:16px;
    padding:18px; box-shadow:0 20px 60px rgba(0,0,0,.5); border:1px solid rgba(255,255,255,.06);
  }
  .card h3{margin:4px 0 8px; font-size:20px}
  .card p{margin:8px 0 0; color:#cfd1d6}
  .card footer{display:flex; gap:10px; justify-content:flex-end; margin-top:14px}
  .hint{padding:8px 12px; border-radius:10px; border:1px dashed rgba(255,255,255,.25); color:#b9bcc2}
  .toast{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
    background:var(--glass); color:#fff; padding:10px 14px; border-radius:12px; display:none;
  }

  /* –ü—Ä–µ–ª–æ–∞–¥–µ—Ä */
  .loader{position:absolute; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.35); z-index:4}
  .ring{width:42px; height:42px; border-radius:50%; border:4px solid rgba(255,255,255,.25); border-top-color:var(--brand); animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* –ê–¥–∞–ø—Ç–∏–≤ */
  @media (max-width:540px){
    .hud{height:auto; padding:8px 10px; gap:8px; flex-wrap:wrap}
    .badge{font-size:14px}
    .pill{font-size:14px}
    .btn{padding:9px 12px}
  }
</style>
</head>
<body>

<header class="hud" aria-live="polite">
  <div class="badge">–£—Ä–æ–≤–µ–Ω—å: <span id="levelLabel" class="brand">1/4</span></div>
  <div class="progress" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å">
    <div id="progressBar" class="bar"></div>
  </div>
  <button id="hintBtn" class="btn" type="button">–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
</header>

<main class="stage-wrap">
  <div id="stage" class="stage" role="application" aria-label="–ò–≥—Ä–æ–≤–∞—è —Å—Ü–µ–Ω–∞">
    <div id="bg" class="layer" aria-hidden="true"></div>
    <div id="actors" class="layer" aria-label="–≠–ª–µ–º–µ–Ω—Ç—ã —É—Ä–æ–≤–Ω—è"></div>
    <div id="loader" class="loader" hidden><div class="ring" role="progressbar" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶"></div></div>
  </div>
  <div class="dock">
    <div id="levelTask" class="pill">–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ</div>
    <div class="pill">–û—á–∫–∏: <span id="score">0</span></div>
  </div>
</main>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∑–∞–¥–∞–Ω–∏—è/–∏—Å—Ç–æ—Ä–∏–∏ -->
<section id="modal" class="modal" aria-hidden="true">
  <div class="card" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <h3 id="mTitle">–ù–∞—à–ª–∞ –®–∞–≥—É–Ω—é!</h3>
    <p id="mStory"></p>
    <p id="mQuest" class="hint"></p>
    <footer>
      <button type="button" class="btn" id="doneBtn">–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
    </footer>
  </div>
</section>

<div id="toast" class="toast"></div>

<script>
/* ======================= –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´ ======================= */
/* –í–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏ –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ URL. */
const GAME_CONFIG = {
  assets: {
    bg1: 'assets/bg_camp_day.png',       // —Ñ–æ–Ω –¥–ª—è —É—Ä–æ–≤–Ω—è 1 (–∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ª–∞–≥–µ—Ä—è –¥–Ω—ë–º)
    bg2: 'assets/bg_camp_route.png',     // —Ñ–æ–Ω –¥–ª—è —É—Ä–æ–≤–Ω—è 2 (–¥–æ—Ä–æ–∂–∫–∞/—Ñ–ª–∞–≥–∏)
    bg3: 'assets/bg_cabins_evening.png', // —Ñ–æ–Ω –¥–ª—è —É—Ä–æ–≤–Ω—è 3 (–¥–æ–º–∏–∫–∏ –≤–µ—á–µ—Ä–æ–º)
    bg4: 'assets/bg_camp_night.png',     // —Ñ–æ–Ω –¥–ª—è —É—Ä–æ–≤–Ω—è 4 (–Ω–æ—á–Ω–∞—è –ø–æ–ª—è–Ω–∞)
    ghost: 'assets/ghost_main.png',      // –≤–∞—à –®–∞–≥—É–Ω—è (–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π PNG)
    // ¬´–æ–±–º–∞–Ω–∫–∏¬ª (–ø–æ—Ö–æ–∂–∏–µ –ø–æ —Ñ–æ—Ä–º–µ –∏ —Ü–≤–µ—Ç—É –æ–±—ä–µ–∫—Ç—ã)
    decoys: [
      'assets/decoy_blanket.png',
      'assets/decoy_towel.png',
      'assets/decoy_mug_steam.png',
      'assets/decoy_light_blob.png',
      'assets/decoy_socks.png',
      'assets/decoy_steam_cloud.png'
    ]
  },

  /* –û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π.
     x/y/scale ‚Äî –≤ –ü–†–û–¶–ï–ù–¢–ê–• –æ—Ç —Å—Ü–µ–Ω—ã (—É–¥–æ–±–Ω–æ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–∞). */
  levels: [
    {
      bg: 'bg1',
      story: '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ –≤ –ª–∞–≥–µ—Ä–µ! –û—Å–µ–Ω—å —à—É—Ä—à–∏—Ç, —á–∞–π–Ω–∏–∫ —à—É–º–∏—Ç, –∞ –®–∞–≥—É–Ω—è –≥–¥–µ-—Ç–æ —Ä—è–¥–æ–º.',
      quest: '–ü—Ä–æ–π–¥–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞–π –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã.',
      hint: '–®–∞–≥—É–Ω—è –ª—é–±–∏—Ç –±—ã–≤–∞—Ç—å —Ä—è–¥–æ–º —Å —Ç—ë–ø–ª—ã–º–∏ –≤–µ—â–∞–º–∏.',
      ghost: { x: 62, y: 62, w: 10 },  // —à–∏—Ä–∏–Ω–∞ –≤ % (–≤—ã—Å–æ—Ç–∞ –ø–æ—Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      decoys: [
        { x: 18, y: 64, w: 9, img: 0 },
        { x: 72, y: 28, w: 8, img: 2 },
        { x: 40, y: 70, w: 10, img: 4 }
      ]
    },
    {
      bg: 'bg2',
      story: '–°–ª—ã—à–∏—à—å —Ö—Ä—É—Å—Ç –ª–∏—Å—Ç—å–µ–≤? –≠—Ç–æ –º–∞—Ä—à-–ø–∞—Ä–∞–¥ –æ—Å–µ–Ω–∏.',
      quest: '–®–∞–≥–∞–π 1 –º–∏–Ω—É—Ç—É –ø–æ–¥ –º—É–∑—ã–∫—É –∏–ª–∏ 500 —à–∞–≥–æ–≤ –∑–∞ –¥–µ–Ω—å.',
      hint: '–ò—â–∏ —Å–≤–µ—Ç–ª–æ–µ –ø—è—Ç–Ω—ã—à–∫–æ –º–µ–∂–¥—É —Ñ–ª–∞–∂–∫–∞–º–∏.',
      ghost: { x: 35, y: 38, w: 9 },
      decoys: [
        { x: 12, y: 52, w: 8, img: 1 },
        { x: 60, y: 18, w: 7, img: 3 }
      ]
    },
    {
      bg: 'bg3',
      story: '–¢–∏—Ö–∏–π —á–∞—Å. –ü–µ—Ä–µ–¥ —Å–Ω–æ–º ‚Äî –Ω–µ–º–Ω–æ–≥–æ –¥—ã—Ö–∞–Ω–∏—è –∏ —Ä–∞—Å—Ç—è–∂–∫–∏.',
      quest: '–í–¥–æ—Ö –Ω–∞ 4 —à–∞–≥–∞, –≤—ã–¥–æ—Ö –Ω–∞ 4 ‚Äî –ø–æ–≤—Ç–æ—Ä–∏ 6 —Ä–∞–∑.',
      hint: '–ü–æ—Å–º–æ—Ç—Ä–∏ —Ç–∞–º, –≥–¥–µ –≤ –æ–∫–Ω–µ –º—è–≥–∫–∏–π —Å–≤–µ—Ç.',
      ghost: { x: 77, y: 46, w: 8 },
      decoys: [
        { x: 22, y: 58, w: 9, img: 5 },
        { x: 58, y: 72, w: 8, img: 0 }
      ]
    },
    {
      bg: 'bg4',
      story: '–í–µ—á–µ—Ä —É –∫–æ—Å—Ç—Ä–∞. –ö–æ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—à—å —Ç–µ–ø–ª–æ ‚Äî –∑–∞–≥–æ—Ä–∞–µ—Ç—Å—è –≤–µ—Å—å –ª–∞–≥–µ—Ä—å.',
      quest: '–ó–∞–≤–µ—Ä—à–∏ –¥–µ–Ω—å 1000 —à–∞–≥–∞–º–∏. –ú–∞–ª–µ–Ω—å–∫–∏–º–∏, –Ω–æ —É–≤–µ—Ä–µ–Ω–Ω—ã–º–∏.',
      hint: '–ì–¥–µ-—Ç–æ —Ä—è–¥–æ–º —Å –æ–≥–æ–Ω—å–∫–æ–º.',
      ghost: { x: 50, y: 40, w: 9 },
      decoys: [
        { x: 20, y: 42, w: 8, img: 2 },
        { x: 66, y: 68, w: 9, img: 1 },
        { x: 30, y: 22, w: 7, img: 3 }
      ]
    }
  ]
};
/* ============================================================= */

const $ = s => document.querySelector(s);
const stage = $('#stage');
const bgLayer = $('#bg');
const actors = $('#actors');
const modal = $('#modal');
const mStory = $('#mStory');
const mQuest = $('#mQuest');
const levelTask = $('#levelTask');
const levelLabel = $('#levelLabel');
const progressBar = $('#progressBar');
const toast = $('#toast');
const loader = $('#loader');
const hintBtn = $('#hintBtn');

let state = { levelIndex: 0, score: 0, preloaded: new Map() };

/* –£—Ç–∏–ª–∏—Ç—ã */
function showToast(msg, t=1400){
  toast.textContent = msg; toast.style.display='block';
  clearTimeout(showToast.tid);
  showToast.tid = setTimeout(()=> toast.style.display='none', t);
}
function preload(src){
  if(state.preloaded.has(src)) return state.preloaded.get(src);
  const img = new Image(); img.src = src;
  state.preloaded.set(src, img);
  return img;
}
function setBg(url){ bgLayer.style.background = `center/cover no-repeat url('${url}')`; }

function percentPos(el, {x,y,w}){
  el.style.left = x + '%';
  el.style.top  = y + '%';
  el.style.width = w + '%';
  el.style.transform = 'translate(-50%,-50%)';
}

/* –†–µ–Ω–¥–µ—Ä —É—Ä–æ–≤–Ω—è */
function renderLevel(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  levelLabel.textContent = `${state.levelIndex+1}/${GAME_CONFIG.levels.length}`;
  progressBar.style.width = ((state.levelIndex)/GAME_CONFIG.levels.length*100) + '%';
  levelTask.textContent = '–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ';
  actors.innerHTML = '';

  loader.hidden = false;

  const bgUrl = GAME_CONFIG.assets[L.bg];
  setBg(bgUrl);
  preload(bgUrl);
  preload(GAME_CONFIG.assets.ghost);
  L.decoys.forEach(d => preload(GAME_CONFIG.assets.decoys[d.img]));

  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–º–∞–Ω–∫–∏
  L.decoys.forEach(d => {
    const el = document.createElement('img');
    el.className = 'sprite';
    el.alt = '–æ–±—ä–µ–∫—Ç';
    el.src = GAME_CONFIG.assets.decoys[d.img];
    percentPos(el, d);
    el.addEventListener('click', () => showToast('–≠—Ç–æ –Ω–µ –®–∞–≥—É–Ω—è üòä'));
    actors.appendChild(el);
  });

  // –î–æ–±–∞–≤–ª—è–µ–º –®–∞–≥—É–Ω—é
  const ghost = document.createElement('img');
  ghost.className = 'sprite ghost';
  ghost.alt = '–®–∞–≥—É–Ω—è';
  ghost.src = GAME_CONFIG.assets.ghost;
  percentPos(ghost, L.ghost);
  ghost.addEventListener('click', onFoundGhost);
  actors.appendChild(ghost);

  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –Ω–µ –º–∏–≥–∞–ª–æ
  setTimeout(()=> loader.hidden = true, 200);
}

function onFoundGhost(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  mStory.textContent = L.story;
  mQuest.textContent = '–ó–∞–¥–∞–Ω–∏–µ: ' + L.quest;
  modal.style.display = 'grid';
  modal.setAttribute('aria-hidden', 'false');
  state.score += 100;
  $('#score').textContent = state.score.toString();
}

$('#doneBtn').addEventListener('click', ()=>{
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden', 'true');

  // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
  const last = (state.levelIndex >= GAME_CONFIG.levels.length - 1);
  if(last){
    progressBar.style.width = '100%';
    showToast('üèÜ –ò–≥—Ä–∞ –ø—Ä–æ–π–¥–µ–Ω–∞! –õ–∞–≥–µ—Ä—å –æ–∂–∏–ª.'); 
    levelTask.textContent = '–ú–æ–ª–æ–¥–µ—Ü! –¢—ã –Ω–∞—à–ª–∞ –®–∞–≥—É–Ω—é –≤–æ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö.';
  } else {
    state.levelIndex++;
    renderLevel();
  }
});

hintBtn.addEventListener('click', ()=>{
  const hint = GAME_CONFIG.levels[state.levelIndex].hint || '–ü—Ä–∏—Å–º–æ—Ç—Ä–∏—Å—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ –∫ —Å–≤–µ—Ç–ª—ã–º –ø—è—Ç–Ω–∞–º.';
  showToast('–ü–æ–¥—Å–∫–∞–∑–∫–∞: ' + hint, 2000);
});

/* –°—Ç–∞—Ä—Ç */
(function init(){
  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–≥–æ, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ ¬´–ø–æ–¥–≥—Ä—É–∑–æ–∫¬ª –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º
  const A = GAME_CONFIG.assets;
  Object.values(A).flat().forEach(v=>{
    if(typeof v === 'string') preload(v);
  });
  renderLevel();
})();
</script>
</body>
</html>
