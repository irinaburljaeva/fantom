<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–®–ê–ì–ê–ô –î–û–ú–ê ‚Äî –ù–∞–π–¥–∏ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è</title>
<style>
  :root{ --page:#fff; --text:#222428; --brand:#e24a27; --panel:#f6f7f8; --shadow:rgba(0,0,0,.10) }
  html,body{height:100%}
  body{margin:0;background:var(--page);color:var(--text);font:16px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

  /* ======= –ò–Ω—Ç—Ä–æ ======= */
  .intro-wrap{max-width:1200px; margin:20px auto 10px; padding:0 12px}
  .intro{position:relative; overflow:hidden; border-radius:20px; height:min(70vh, 680px);
         box-shadow:0 18px 48px var(--shadow); border:1px solid rgba(0,0,0,.06); background:#fafafa}
  .intro figure{position:absolute; inset:0; margin:0}
  .intro img{width:100%; height:100%; object-fit:cover; display:block; filter:brightness(.85); opacity:0; transition:opacity .3s ease}
  .intro img.ready{opacity:1}
  .intro .veil{position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45))}
  .intro .panel{position:relative; z-index:1; max-width:820px; margin:14px; background:rgba(255,255,255,.9); color:#202226;
    border:1px solid rgba(0,0,0,.06); border-radius:16px; padding:18px; backdrop-filter:blur(4px)}
  .intro h1{margin:0 0 10px;font-size:22px}
  .intro blockquote{margin:12px 0; padding:12px; background:#fff; border-left:4px solid var(--brand); border-radius:8px}
  .btn{cursor:pointer; border:0; border-radius:12px; background:var(--brand); color:#fff; font-weight:700; padding:10px 14px;
       box-shadow:0 6px 18px rgba(226,74,39,.25)}

  /* ======= HUD ======= */
  .hud{position:sticky; top:0; display:flex; gap:10px; align-items:center; padding:10px 14px;
       background:linear-gradient(180deg,#fff,rgba(255,255,255,.86)); z-index:5; border-bottom:1px solid rgba(0,0,0,.06)}
  .badge{display:inline-flex; gap:8px; align-items:center; background:#fff; padding:8px 12px; border-radius:999px; border:1px solid rgba(0,0,0,.06)}
  .brand{color:var(--brand); font-weight:700}
  .progress{flex:1; height:8px; background:#eceff1; border-radius:999px; overflow:hidden}
  .bar{height:100%; width:0; background:var(--brand); transition:width .35s ease}
  .pill{background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:14px; padding:10px 14px; color:#444}

  /* ======= –ò–≥—Ä–∞ + –ø—Ä–∞–≤—ã–π –±–ª–æ–∫ ======= */
  .play-wrap{max-width:1200px; margin:10px auto 24px; padding:0 12px; display:flex; gap:18px; align-items:flex-start; flex-wrap:wrap}
  .stage-wrap{position:relative; flex:1 1 680px; min-width:320px; aspect-ratio:16/10}
  .stage{position:relative; width:100%; height:100%; overflow:hidden; border-radius:16px; background:#ddd center/cover no-repeat;
         box-shadow:0 12px 36px var(--shadow); border:1px solid rgba(0,0,0,.06)}
  .layer{position:absolute; inset:0}
  #bg{transition:opacity .25s ease}
  .dock{width:100%; display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:10px}

  .side{flex:0 0 min(380px,34vw); background:var(--panel); border:1px solid rgba(0,0,0,.06); border-radius:16px;
        padding:16px; box-shadow:0 10px 24px var(--shadow); display:none}
  .side h3{margin:6px 0 8px}
  .side .hint{margin:10px 0 0; background:#fff; border:1px dashed rgba(0,0,0,.2); border-radius:10px; padding:10px 12px}
  .side .btns{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap}

  .toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#111; color:#fff; padding:10px 14px; border-radius:12px; display:none; box-shadow:0 10px 24px rgba(0,0,0,.25)}
  .loader{position:absolute; inset:0; display:grid; place-items:center; background:rgba(255,255,255,.35); z-index:4}
  .ring{width:42px; height:42px; border-radius:50%; border:4px solid rgba(0,0,0,.12); border-top-color:var(--brand); animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.4); z-index:15; padding:16px}
  .card{width:min(520px,92vw); background:#fff; color:#222; border:1px solid rgba(0,0,0,.08); border-radius:14px; padding:16px; box-shadow:0 16px 40px var(--shadow)}
  .actions{display:flex; gap:8px; justify-content:flex-end; margin-top:10px}

  .celebrate{position:absolute; inset:0; display:none; place-items:center; pointer-events:none}
  .heart{font-size:64px; opacity:0; transform:scale(.7); animation:pop 1.2s ease forwards}
  @keyframes pop{0%{opacity:0; transform:scale(.7) translateY(20px)} 50%{opacity:1; transform:scale(1) translateY(-4px)} 100%{opacity:0; transform:scale(1.15) translateY(-24px)}}

  .devbox{outline:2px dashed #ffb703; background:transparent}
  .coords{position:fixed; top:64px; left:50%; transform:translateX(-50%); background:#111; color:#fff; padding:6px 10px; border-radius:10px; display:none; z-index:9}
</style>
</head>
<body>

<!-- ===== –ò–Ω—Ç—Ä–æ (–≤–∏–¥–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ) ===== -->
<div class="intro-wrap" id="introWrap">
  <section id="intro" class="intro">
    <figure><img id="introImg" alt="–û—Å–µ–Ω–Ω–∏–π –ª–µ—Å"></figure>
    <div class="veil" aria-hidden="true"></div>
    <div class="panel">
      <h1>–û—Å–µ–Ω–Ω–∏–π –ª–∞–≥–µ—Ä—å ¬´–®–ê–ì–ê–ô –î–û–ú–ê¬ª</h1>
      <p>–í –ª–∞–≥–µ—Ä–µ –®–ê–ì–ê–ô –î–û–ú–ê –æ—Å–µ–Ω—å—é –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á—É–¥–µ—Å–∞. –û–¥–Ω–∞–∂–¥—ã –≤ —á–∞—Ç –ø—Ä–∏—à–ª–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:</p>
      <blockquote>
        ¬´–ü—Ä–∏–≤–µ—Ç! –Ø –∂–∏–≤—É –∑–¥–µ—Å—å —Å –ø—Ä–æ—à–ª–æ–≥–æ —Å–µ–∑–æ–Ω–∞. –Ø –ª—é–±–ª—é —á–∞–π —Å –æ–±–ª–µ–ø–∏—Ö–æ–π, –æ—Å–µ–Ω–Ω–∏–µ –ª–∏—Å—Ç—å—è –∏ —à–∞–≥–∏ –ø–æ —É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–æ—Å–µ. –ê –µ—â—ë —è –Ω–µ–º–Ω–æ–∂–∫–æ‚Ä¶ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π.¬ª
      </blockquote>
      <p>–¢–∞–∫ –≤—Å–µ —É–∑–Ω–∞–ª–∏ –ø—Ä–æ –ü—Ä–∏–≤–∏–¥–µ–Ω–∏–µ –û—Å–µ–Ω–Ω–µ–≥–æ –õ–∞–≥–µ—Ä—è ‚Äî –®–∞–≥—É–Ω—é. –û–Ω –Ω–µ –ø—É–≥–∞–µ—Ç, –∞ –ø–æ–º–æ–≥–∞–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è, –≥—Ä–µ—Ç—å—Å—è –∏ –Ω–µ –≥—Ä—É—Å—Ç–∏—Ç—å. –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è: –∑–∞ –Ω–µ–¥–µ–ª—é –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –®–∞–≥—É–Ω—é –Ω–∞ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö –ª–∞–≥–µ—Ä—è –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.</p>
      <footer><button id="startBtn" class="btn" type="button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button></footer>
    </div>
  </section>
</div>

<!-- ===== HUD –∏ –∏–≥—Ä–∞ (—Å–∫—Ä—ã—Ç—ã –¥–æ —Å—Ç–∞—Ä—Ç–∞!) ===== -->
<header class="hud" id="hud" hidden aria-live="polite">
  <div class="badge">–£—Ä–æ–≤–µ–Ω—å: <span id="levelLabel" class="brand">1/1</span></div>
  <div class="progress"><div id="progressBar" class="bar"></div></div>
  <button id="hintBtn" class="btn" type="button">–ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
</header>

<section class="play-wrap" id="gameWrap" hidden>
  <div class="stage-wrap">
    <div id="stage" class="stage" role="application" aria-label="–ò–≥—Ä–æ–≤–∞—è —Å—Ü–µ–Ω–∞">
      <div id="bg" class="layer"></div>
      <div id="celebrate" class="celebrate"><div class="heart">üíñ</div></div>
      <div id="loader" class="loader" hidden><div class="ring"></div></div>
      <div id="err" class="layer" style="display:none;place-items:center;color:#b00020;font-weight:600;background:rgba(255,255,255,.7)">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è</div>
    </div>
    <div class="dock">
      <div id="levelTask" class="pill">–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ</div>
      <div class="pill">–û—á–∫–∏: <span id="score">0</span></div>
    </div>
  </div>

  <aside id="sidePanel" class="side">
    <h3>–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!</h3>
    <p>–ü–æ—Ä–∞ —Ä–∞–∑–æ–≥–Ω–∞—Ç—å —Å–æ–Ω. –Ø –ª—é–±–ª—é –Ω–∞—á–∏–Ω–∞—Ç—å –¥–µ–Ω—å —Å –ª—ë–≥–∫–∏—Ö —à–∞–≥–æ–≤ ‚Äî –∞ —Ç—ã?</p>
    <div class="hint">
      <div>üéØ <b>–ó–∞–¥–∞–Ω–∏–µ:</b> –ø—Ä–æ–π—Ç–∏ 300 —à–∞–≥–æ–≤ –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞—Ä—è–¥–∫—É –Ω–∞ 2 –º–∏–Ω—É—Ç—ã.</div>
      <div style="margin-top:6px;">üéÅ –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è –º–∏–Ω–∏-–∞–Ω–∏–º–∞—Ü–∏—è ¬´–¥—ã–º ‚Üí —Å–µ—Ä–¥—Ü–µ¬ª –∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å.</div>
    </div>
    <div class="btns">
      <button class="btn" id="reportBtn" type="button">–û—Ç—á–∏—Ç–∞—Ç—å—Å—è</button>
      <button class="btn" id="nextBtn" type="button" disabled style="background:#26a269">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å</button>
    </div>
  </aside>
</section>

<!-- –ú–æ–¥–∞–ª–∫–∞ –æ—Ç—á—ë—Ç–∞ -->
<section id="reportModal" class="modal" aria-hidden="true">
  <div class="card" role="dialog" aria-modal="true">
    <h4>–û—Ç—á—ë—Ç –ø–æ –∑–∞–¥–∞–Ω–∏—é</h4>
    <label><input type="radio" name="task" value="steps"> –Ø –ø—Ä–æ—à—ë–ª(–ª–∞) 300 —à–∞–≥–æ–≤</label><br/>
    <label><input type="radio" name="task" value="warmup"> –Ø —Å–¥–µ–ª–∞–ª(–∞) –∑–∞—Ä—è–¥–∫—É 2 –º–∏–Ω—É—Ç—ã</label>
    <div class="actions">
      <button class="btn" id="cancelReport" type="button" style="background:#e7eaee;color:#222;box-shadow:none">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn" id="submitReport" type="button">–ì–æ—Ç–æ–≤–æ</button>
    </div>
  </div>
</section>

<div id="toast" class="toast"></div>
<div id="coords" class="coords"></div>

<script>
/* === –ü—É—Ç–∏ (–∫–æ—Ä–µ–Ω—å GitHub) === */
const ASSETS = { start:'start.jpg', lvl1:'lvl1.jpg', lvl1found:'lvl1found.jpg' };

/* === –ö–æ–Ω—Ñ–∏–≥ —É—Ä–æ–≤–Ω–µ–π === */
const GAME_CONFIG = {
  levels: [{
    bg: ASSETS.lvl1,
    bgFound: ASSETS.lvl1found,
    hotspot: { x: 95, y: 43, w: 6, h: 18 }, // –±–ª–∏–∂–µ –∫ –ø—Ä–∞–≤–æ–π —Å—Ç–µ–Ω–µ
    hint: ''
  }]
};

const $ = s => document.querySelector(s);
const introImg = $('#introImg'), introWrap = $('#introWrap'), startBtn = $('#startBtn');
const hud = $('#hud'), gameWrap = $('#gameWrap');
const stage = $('#stage'), bgLayer = $('#bg'), loader = $('#loader'), celebrate = $('#celebrate'), errLayer = $('#err');
const sidePanel = $('#sidePanel'), hintBtn = $('#hintBtn'), levelLabel = $('#levelLabel'), progressBar = $('#progressBar'), levelTask = $('#levelTask'), nextBtn = $('#nextBtn'), reportBtn = $('#reportBtn');
const toast = $('#toast'), coordsBox = $('#coords');
const reportModal = $('#reportModal'), cancelReport = $('#cancelReport'), submitReport = $('#submitReport');

let state = { levelIndex: 0, started:false, score:0, DEV:false, GRAB:false };

function preload(src){ return new Promise((res,rej)=>{ const im=new Image(); im.onload=()=>res(src); im.onerror=()=>rej(src); im.src=src; }); }
function setBg(url){ bgLayer.style.opacity='0'; setTimeout(()=>{ bgLayer.style.background=`center/cover no-repeat url('${url}')`; bgLayer.style.opacity='1'; },80); }
function showToast(msg,t=1600){ toast.textContent=msg; toast.style.display='block'; clearTimeout(showToast.tid); showToast.tid=setTimeout(()=>toast.style.display='none',t); }
function clickToPercent(e){ const r=stage.getBoundingClientRect(); return {x:(e.clientX-r.left)/r.width*100, y:(e.clientY-r.top)/r.height*100}; }
function pointInRect(pt,r){ const L=r.x-r.w/2,R=r.x+r.w/2,T=r.y-r.h/2,B=r.y+r.h/2; return pt.x>=L&&pt.x<=R&&pt.y>=T&&pt.y<=B; }

/* –ò–Ω—Ç—Ä–æ-—Ñ–æ—Ç–æ */
preload(ASSETS.start).then(src=>{ introImg.src=src; introImg.onload=()=>introImg.classList.add('ready'); }).catch(()=>{ introImg.remove(); });

/* –°—Ç–∞—Ä—Ç: —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º HUD –∏ –∏–≥—Ä—É */
startBtn.addEventListener('click', async ()=>{
  introWrap.style.display='none';
  hud.hidden = false;
  gameWrap.hidden = false;
  await startLevel(0);
});

/* –£—Ä–æ–≤–µ–Ω—å */
async function startLevel(i){
  state.levelIndex = i;
  sidePanel.style.display='none';
  hintBtn.style.display = (i===0)?'none':'inline-flex';
  levelLabel.textContent = `${i+1}/${GAME_CONFIG.levels.length}`;
  progressBar.style.width = (i/GAME_CONFIG.levels.length*100)+'%';
  levelTask.textContent = '–ù–∞–π–¥–∏ –®–∞–≥—É–Ω—é –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ';
  nextBtn.disabled = !isLevelDone(i);

  loader.hidden=false; errLayer.style.display='none';
  const L = GAME_CONFIG.levels[i];
  const safety = setTimeout(()=> loader.hidden=true, 2000);

  try{
    const src = await preload(L.bg);   // <-- –∂–¥—ë–º –∑–∞–≥—Ä—É–∑–∫—É lvl1.jpg
    setBg(src);
    if(L.bgFound) preload(L.bgFound);  // –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É ¬´–ø–æ—Å–ª–µ –∫–ª–∏–∫–∞¬ª
  }catch(src){
    errLayer.style.display='grid';
    errLayer.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: ' + src;
  }finally{
    clearTimeout(safety); loader.hidden=true;
  }

  stage.onclick = (ev)=>{
    const pt = clickToPercent(ev);
    if (state.GRAB){ coordsBox.textContent=`x:${pt.x.toFixed(1)} y:${pt.y.toFixed(1)}`; coordsBox.style.display='block'; return; }
    if (L.hotspot && pointInRect(pt, L.hotspot)){ onFound(L); }
    else { stage.animate([{transform:'scale(1)'},{transform:'scale(1.01)'},{transform:'scale(1)'}], {duration:140}); showToast('–ù–µ –∑–¥–µ—Å—å üòä –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!'); }
  };
}

/* –ü–æ—Å–ª–µ –Ω–∞—Ö–æ–¥–∫–∏ */
function onFound(L){
  stage.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}], {duration:320, easing:'ease'});
  if(L.bgFound) setBg(L.bgFound);
  sidePanel.style.display='block';
  state.score += 100; $('#score').textContent = state.score;
}

/* –û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å */
reportBtn.addEventListener('click', ()=>{ reportModal.style.display='grid'; reportModal.setAttribute('aria-hidden','false'); });
cancelReport.addEventListener('click', ()=>{ reportModal.style.display='none'; reportModal.setAttribute('aria-hidden','true'); });
submitReport.addEventListener('click', ()=>{
  const done = document.querySelector('input[name="task"]:checked');
  if(!done){ showToast('–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è üôÇ'); return; }
  localStorage.setItem('level_done_'+state.levelIndex, '1');
  reportModal.style.display='none'; reportModal.setAttribute('aria-hidden','true');
  celebrate.style.display='grid';
  celebrate.firstElementChild.style.animation='none'; void celebrate.firstElementChild.offsetWidth; celebrate.firstElementChild.style.animation='';
  setTimeout(()=> celebrate.style.display='none', 1200);
  nextBtn.disabled = false;
  showToast('–û—Ç–ª–∏—á–Ω–æ! –£—Ä–æ–≤–µ–Ω—å –∑–∞—Å—á–∏—Ç–∞–Ω ‚úÖ', 1800);
});
nextBtn.addEventListener('click', ()=>{
  showToast('–í—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–π–¥–µ–Ω—ã! üéâ', 2000);
});

function isLevelDone(i){ return localStorage.getItem('level_done_'+i)==='1'; }

/* Dev: D ‚Äî —Ö–∏—Ç–±–æ–∫—Å, G ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã */
document.addEventListener('keydown', (e)=>{
  const L = GAME_CONFIG.levels[state.levelIndex];
  if(e.key.toLowerCase()==='d'){
    document.querySelectorAll('.devbox').forEach(n=>n.remove());
    if(L.hotspot){
      const el=document.createElement('div');
      el.className='devbox';
      Object.assign(el.style,{position:'absolute',
        left:`${L.hotspot.x - L.hotspot.w/2}%`, top:`${L.hotspot.y - L.hotspot.h/2}%`,
        width:`${L.hotspot.w}%`, height:`${L.hotspot.h}%`, pointerEvents:'none'});
      stage.appendChild(el);
    }
  }
  if(e.key.toLowerCase()==='g'){ state.GRAB = !state.GRAB; coordsBox.style.display = state.GRAB?'block':'none'; }
});
</script>
</body>
</html>
