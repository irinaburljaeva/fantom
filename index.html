<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ШАГАЙ ДОМА — Найди Привидение Осеннего Лагеря</title>
<style>
  :root{ --bg:#0f0f10; --ui:#ffffff; --brand:#e24a27; --panel:#1b1c1f; --glass:rgba(18,19,22,.72) }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ui);
       font:16px/1.45 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}

  /* Вводный слайд */
  .intro{
    position:fixed; inset:0; z-index:20;
    display:grid; place-items:center; overflow:hidden;
    background:#000 center/cover no-repeat;
  }
  .intro::before{ /* затемняющая вуаль для читабельности текста */
    content:""; position:absolute; inset:0;
    background:linear-gradient(180deg, rgba(0,0,0,.46), rgba(0,0,0,.62));
  }
  .intro .panel{
    position:relative; width:min(920px, 92vw);
    background:rgba(18,19,22,.45);
    border:1px solid rgba(255,255,255,.10);
    border-radius:16px; padding:18px 18px 14px;
    backdrop-filter: blur(4px);
  }
  .intro h1{margin:0 0 10px;font-size:22px}
  .intro p{margin:10px 0 0}
  .intro blockquote{
    margin:12px 0; padding:12px;
    background:rgba(255,255,255,.08);
    border-left:4px solid var(--brand); border-radius:8px;
  }
  .intro footer{display:flex; justify-content:flex-end; gap:10px; margin-top:12px}
  .btn{
    cursor:pointer; border:0; border-radius:12px; background:var(--brand); color:#fff;
    font-weight:700; padding:10px 14px; box-shadow:0 6px 18px rgba(226,74,39,.35)
  }

  /* HUD */
  .hud{
    position:fixed; inset:0 0 auto 0; height:56px;
    display:flex; align-items:center; gap:10px;
    padding:10px 14px; background:linear-gradient(180deg, rgba(0,0,0,.55), transparent);
    z-index:5; pointer-events:none;
  }
  .badge{pointer-events:auto; display:inline-flex; gap:8px; align-items:center;
    background:rgba(255,255,255,.08); padding:8px 12px; border-radius:999px; backdrop-filter:saturate(130%) blur(4px)}
  .brand{color:var(--brand); font-weight:700}
  .progress{flex:1; height:8px; background:rgba(255,255,255,.15); border-radius:999px; overflow:hidden}
  .bar{height:100%; width:0; background:var(--brand); transition:width .35s ease}
  #hintBtn{pointer-events:auto}

  /* Сцена игры */
  .stage-wrap{position:relative; width:100%; max-width:1000px; margin:70px auto 18px; aspect-ratio:16/10}
  .stage{
    position:relative; width:100%; height:100%; overflow:hidden; border-radius:16px;
    background:#121316 center/cover no-repeat; box-shadow:0 12px 40px rgba(0,0,0,.35)
  }
  .layer{position:absolute; inset:0}
  #bg{transition:opacity .25s ease}
  .dock{
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    max-width:1000px; margin:0 auto; padding:10px 4px 18px
  }
  .pill{
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
    border-radius:14px; padding:10px 14px; color:#d7d9dd
  }

  /* Модалка задания */
  .modal{position:fixed; inset:0; display:none; place-items:center; padding:20px; z-index:10; background:rgba(0,0,0,.35)}
  .card{width:min(680px,92vw); background:var(--panel); color:#e9eaec; border-radius:16px; padding:18px; border:1px solid rgba(255,255,255,.06)}
  .card h3{margin:4px 0 8px; font-size:20px}
  .hint{padding:8px 12px; border-radius:10px; border:1px dashed rgba(255,255,255,.25); color:#b9bcc2}

  .toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:var(--glass); color:#fff; padding:10px 14px; border-radius:12px; display:none}
  .loader{position:absolute; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.35); z-index:4}
  .ring{width:42px; height:42px; border-radius:50%; border:4px solid rgba(255,255,255,.25); border-top-color:var(--brand); animation:spin .9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Dev hitbox */
  .devbox{outline:2px dashed #ffb703; background:transparent}

  @media (max-width:540px){
    .hud{height:auto; padding:8px 10px; gap:8px; flex-wrap:wrap}
    .pill,.btn{font-size:14px}
  }
</style>
</head>
<body>

<!-- Вводный слайд: ТЕКСТ ПОВЕРХ start.jpg -->
<section id="intro" class="intro" style="background-image:url('assets/start.jpg')">
  <div class="panel">
    <h1>Осенний лагерь «ШАГАЙ ДОМА»</h1>
    <p>В лагере ШАГАЙ ДОМА осенью всегда происходят чудеса. Однажды в чат пришло странное сообщение от неизвестного участника:</p>
    <blockquote>
      «Привет! Я живу здесь с прошлого сезона. Я люблю чай с облепихой, осенние листья и шаги по утренней росе. А ещё я немножко… прозрачный.»
    </blockquote>
    <p>Так все узнали про Привидение Осеннего Лагеря — Шагуню. Он не пугает, а помогает двигаться, греться и не грустить. Игра начинается: за неделю нужно найти Шагуню на всех локациях лагеря и выполнить его задания.</p>
    <footer><button id="startBtn" class="btn" type="button">Начать игру</button></footer>
  </div>
</section>

<header class="hud" aria-live="polite">
  <div class="badge">Уровень: <span id="levelLabel" class="brand">1/1</span></div>
  <div class="progress"><div id="progressBar" class="bar"></div></div>
  <button id="hintBtn" class="btn" type="button">Подсказка</button>
</header>

<main class="stage-wrap" aria-hidden="true">
  <div id="stage" class="stage" role="application" aria-label="Игровая сцена">
    <div id="bg" class="layer"></div>
    <div id="actors" class="layer"></div>
    <div id="loader" class="loader" hidden><div class="ring" aria-label="Загрузка…"></div></div>
  </div>
  <div class="dock">
    <div id="levelTask" class="pill">Найди Шагуню на картинке</div>
    <div class="pill">Очки: <span id="score">0</span></div>
  </div>
</main>

<!-- Модалка задания -->
<section id="modal" class="modal" aria-hidden="true">
  <div class="card">
    <h3>Нашла Шагуню!</h3>
    <p id="mStory"></p>
    <p id="mQuest" class="hint"></p>
    <footer><button type="button" class="btn" id="doneBtn">Задание выполнено</button></footer>
  </div>
</section>

<div id="toast" class="toast"></div>

<script>
/* ================== КОНФИГ ================== */
const GAME_CONFIG = {
  levels: [
    {
      bg: 'assets/lvl1.jpg',          // фоновая картинка (до клика)
      bgFound: 'assets/lvl1found.jpg',// фоновая картинка после нахождения
      story: 'Доброе утро в лагере! Осень шуршит, чайник шумит, а Шагуня где-то рядом.',
      quest: 'Пройди 300 шагов или сделай зарядку 2 минуты.',
      hint: 'Ищи у правой стены правого домика.',
      /* «Горячая зона» — прямоугольник в процентах (центр + ширина/высота).
         Эти координаты подобраны под изображение 1152×768,
         где Шагуня стоит справа у правой стены. */
      hotspot: { x: 90, y: 46, w: 8, h: 18 }
    }
  ]
};
/* ============================================ */

const $ = s => document.querySelector(s);
const stage = $('#stage'), bgLayer = $('#bg'), actors = $('#actors');
const levelLabel = $('#levelLabel'), progressBar = $('#progressBar'), levelTask = $('#levelTask');
const modal = $('#modal'), mStory = $('#mStory'), mQuest = $('#mQuest');
const loader = $('#loader'), toast = $('#toast');
const startBtn = $('#startBtn'), intro = $('#intro'), main = document.querySelector('main'), hintBtn = $('#hintBtn');

let state = { levelIndex: 0, score: 0, started:false, preloaded:new Map(), DEV:false };

function preload(src){ if(!src) return; if(state.preloaded.has(src)) return;
  const img = new Image(); img.src = src; state.preloaded.set(src,img);
}
function setBg(url){
  bgLayer.style.opacity = '0';
  setTimeout(()=>{ bgLayer.style.background = `center/cover no-repeat url('${url}')`; bgLayer.style.opacity='1'; }, 120);
}
function showToast(msg,t=1400){ toast.textContent=msg; toast.style.display='block';
  clearTimeout(showToast.tid); showToast.tid=setTimeout(()=>toast.style.display='none',t); }
function clickToPercent(ev){
  const rect = stage.getBoundingClientRect();
  return { x: (ev.clientX-rect.left)/rect.width*100, y: (ev.clientY-rect.top)/rect.height*100 };
}
function pointInRect(pt, r){
  const L=r.x-r.w/2, R=r.x+r.w/2, T=r.y-r.h/2, B=r.y+r.h/2;
  return pt.x>=L && pt.x<=R && pt.y>=T && pt.y<=B;
}

function renderDevHitbox(){
  actors.querySelectorAll('.devbox').forEach(n=>n.remove());
  if(!state.DEV) return;
  const r = GAME_CONFIG.levels[state.levelIndex].hotspot;
  if(!r) return;
  const el = document.createElement('div');
  el.className='devbox';
  Object.assign(el.style,{
    position:'absolute',
    left:`${r.x - r.w/2}%`, top:`${r.y - r.h/2}%`, width:`${r.w}%`, height:`${r.h}%`,
    pointerEvents:'none'
  });
  actors.appendChild(el);
}

function renderLevel(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  levelLabel.textContent = `${state.levelIndex+1}/${GAME_CONFIG.levels.length}`;
  progressBar.style.width = ((state.levelIndex)/GAME_CONFIG.levels.length*100) + '%';
  levelTask.textContent = 'Найди Шагуню на картинке';
  actors.innerHTML=''; loader.hidden=false;

  setBg(L.bg); preload(L.bg); preload(L.bgFound);

  // клики по сцене
  stage.onclick = (ev)=>{
    const pt = clickToPercent(ev);
    if (L.hotspot && pointInRect(pt, L.hotspot)){
      onFound(); // успех
    } else {
      stage.animate([{transform:'scale(1)'},{transform:'scale(1.01)'},{transform:'scale(1)'}], {duration:140});
      showToast('Не здесь 😊 Попробуй ещё!');
    }
  };

  renderDevHitbox();
  setTimeout(()=> loader.hidden=true, 200);
}

function onFound(){
  const L = GAME_CONFIG.levels[state.levelIndex];
  // эффект небольшого приближения
  stage.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}], {duration:320, easing:'ease'});
  if(L.bgFound) setBg(L.bgFound);

  mStory.textContent = L.story;
  mQuest.textContent = 'Задание: ' + L.quest;
  modal.style.display='grid'; modal.setAttribute('aria-hidden','false');

  state.score += 100; $('#score').textContent = state.score;
}

$('#doneBtn').addEventListener('click', ()=>{
  modal.style.display='none'; modal.setAttribute('aria-hidden','true');
  progressBar.style.width='100%';
  levelTask.textContent='Молодец! Ты нашла Шагуню 🎉';
});

hintBtn.addEventListener('click', ()=>{
  const L = GAME_CONFIG.levels[state.levelIndex];
  showToast('Подсказка: ' + (L.hint || 'Присмотрись к светлым пятнам.'), 2200);
});

/* Старт */
startBtn.addEventListener('click', ()=>{
  intro.style.display='none'; main.removeAttribute('aria-hidden');
  state.started = true; renderLevel();
});
/* DEV-хитбокс по клавише D */
document.addEventListener('keydown',(e)=>{ if(e.key.toLowerCase()==='d'){ state.DEV=!state.DEV; renderDevHitbox(); } });

/* Предзагрузка обложки */
preload('assets/start.jpg');
</script>
</body>
</html>
